<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§æ‡§®‡•Å‡§Ø‡•ã‡§ó ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§£‡•ç‡§° - ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6B46C1;
            --secondary: #9333EA;
            --accent: #F59E0B;
            --dark: #1F2937;
            --light: #F9FAFB;
            --success: #10B981;
            --danger: #EF4444;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Noto Sans Devanagari', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .soul-loader {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.3) 70%);
            box-shadow: 0 0 60px rgba(255,255,255,0.6);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Main Menu */
        .main-menu {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            background: var(--gradient);
        }

        .main-menu.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .menu-container {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }

        .game-title {
            font-size: 3rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            margin-bottom: 3rem;
        }

        .stage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stage-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stage-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
        }

        .stage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .stage-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stage-card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
        }

        .stage-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stage-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stage-description {
            color: var(--dark);
            opacity: 0.8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s;
        }

        /* Game Container */
        .game-container {
            display: none;
            min-height: 100vh;
            background: var(--light);
        }

        .game-container.active {
            display: block;
        }

        /* Header */
        .game-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        .back-btn:hover {
            background: var(--secondary);
            transform: scale(1.05);
        }

        .score-display {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
        }

        /* Lesson Content */
        .lesson-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .lesson-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Karma Visualization */
        .soul-container {
            display: flex;
            justify-content: center;
            margin: 3rem 0;
            position: relative;
        }

        .soul-avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 50%, #FF6347 100%);
            position: relative;
            animation: glow 3s ease-in-out infinite;
            box-shadow: 0 0 60px rgba(255,215,0,0.6);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 60px rgba(255,215,0,0.6); }
            50% { box-shadow: 0 0 80px rgba(255,215,0,0.9); }
        }

        .karma-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .karma-layer.active {
            opacity: 0.7;
        }

        /* Karma Cards */
        .karma-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .karma-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .karma-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .karma-card.selected {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .karma-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .karma-description {
            font-size: 0.9rem;
            opacity: 0.95;
            margin-bottom: 1rem;
        }

        .karma-analogy {
            font-style: italic;
            font-size: 0.85rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        /* Interactive Elements */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Minigame Container */
        .minigame-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .game-tile {
            aspect-ratio: 1;
            background: var(--light);
            border: 2px solid var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-tile:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .game-tile.matched {
            background: var(--success);
            color: white;
            pointer-events: none;
        }

        .game-tile.flipped {
            background: var(--secondary);
            color: white;
        }

        /* Quiz Section */
        .quiz-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .question {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--dark);
        }

        .options {
            display: grid;
            gap: 1rem;
        }

        .option {
            background: var(--light);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .option:hover {
            border-color: var(--primary);
            background: white;
        }

        .option.selected {
            border-color: var(--primary);
            background: rgba(107, 70, 193, 0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            animation: slideIn 0.3s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .modal-text {
            color: var(--dark);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }

            .stage-grid {
                grid-template-columns: 1fr;
            }

            .karma-grid {
                grid-template-columns: 1fr;
            }

            .game-board {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.5s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Karma State Visualizer */
        .karma-state-timeline {
            position: relative;
            padding: 2rem 0;
            margin: 2rem 0;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary);
        }

        .timeline-item {
            position: relative;
            padding: 1rem;
            margin: 1rem 0;
            width: 45%;
        }

        .timeline-item:nth-child(odd) {
            left: 0;
            text-align: right;
        }

        .timeline-item:nth-child(even) {
            left: 55%;
            text-align: left;
        }

        .timeline-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }

        .timeline-item:nth-child(odd) .timeline-dot {
            right: -10px;
        }

        .timeline-item:nth-child(even) .timeline-dot {
            left: -10px;
        }

        .timeline-content {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Achievement System */
        .achievement-popup {
            position: fixed;
            top: 2rem;
            right: -400px;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: right 0.5s;
            z-index: 2000;
        }

        .achievement-popup.show {
            right: 2rem;
        }

        .achievement-icon {
            font-size: 2rem;
        }

        .achievement-text {
            flex: 1;
        }

        .achievement-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--dark);
            opacity: 0.8;
        }

        .case-study-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid var(--accent);
        }

        .drag-item {
            background: white;
            padding: 1rem;
            margin: 0.5rem;
            border-radius: 8px;
            cursor: move;
            border: 2px solid var(--primary);
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 100px;
            background: rgba(107, 70, 193, 0.1);
            border: 2px dashed var(--primary);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .drop-zone.drag-over {
            background: rgba(107, 70, 193, 0.2);
        }
        /* Better Mobile Support */
        @media (max-width: 480px) {
            .game-title {
                font-size: 1.8rem;
                padding: 0 1rem;
            }
            
            .stage-card {
                padding: 1.5rem;
                margin: 0.5rem;
            }
            
            .karma-grid {
                grid-template-columns: 1fr;
            }
            
            .game-board {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            
            .timeline-item {
                width: 100% !important;
                left: 0 !important;
                text-align: left !important;
                padding: 0.5rem !important;
            }
            
            .timeline-line {
                left: 10px !important;
            }
            
            .timeline-dot {
                left: 0 !important;
            }
            
            .soul-avatar {
                width: 150px !important;
                height: 150px !important;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.5rem;
            }
            
            .game-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .score-display {
                width: 100%;
                justify-content: center;
            }
            
            /* Fix drag and drop for mobile */
            .drag-item {
                touch-action: none;
            }
        }

        /* Ensure touch events work properly */
        @media (hover: none) {
            .karma-card:active {
                transform: scale(0.98);
            }
            
            .action-btn:active {
                transform: scale(0.98);
            }
            
            .stage-card:active:not(.locked) {
                transform: scale(0.98);
            }
        }
    </style>
    <link rel="stylesheet" href="mobile-fix.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="soul-loader"></div>
        <h2 style="color: white; margin-top: 2rem;">‡§Ü‡§™‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</h2>
    </div>

    <!-- Main Menu -->
    <div class="main-menu" id="mainMenu">
        <div class="menu-container">
            <h1 class="game-title">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§æ‡§®‡•Å‡§Ø‡•ã‡§ó ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§£‡•ç‡§°</h1>
            <p class="subtitle">‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ</p>
            
            <div class="stage-grid">
                <div class="stage-card" onclick="startStage(1)">
                    <div class="stage-icon">üìø</div>
                    <div class="stage-title">‡§ö‡§∞‡§£ ‡•ß: ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</div>
                    <div class="stage-description">‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Ç‡§ß‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡•Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•ã‡§ú</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress1" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stage-card" onclick="startStage(2)">
                    <div class="stage-icon">üîÑ</div>
                    <div class="stage-title">‡§ö‡§∞‡§£ ‡•®: ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§¶‡§∏ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç</div>
                    <div class="stage-description">‡§¨‡§Ç‡§ß ‡§∏‡•á ‡§≤‡•á‡§ï‡§∞ ‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§ ‡§§‡§ï ‡§ï‡•Ä ‡•ß‡•¶ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡§æ‡§®‡•á‡§Ç</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress2" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stage-card" onclick="startStage(3)">
                    <div class="stage-icon">‚è≥</div>
                    <div class="stage-title">‡§ö‡§∞‡§£ ‡•©: ‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§µ‡§ø‡§∂‡•á‡§∑</div>
                    <div class="stage-description">‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§£ ‡§ï‡•á ‡§∞‡§π‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§æ‡§∞‡§§</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress3" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stage-card" id="masterStage" onclick="startMasterChallenge()">
                    <div class="stage-icon">üéÆ</div>
                    <div class="stage-title">‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä</div>
                    <div class="stage-description">‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Æ‡§ù ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress4" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
        <div class="game-header">
            <button class="back-btn" onclick="backToMenu()">‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏</button>
            <div class="score-display">
                <div class="score-item">
                    <span>‚≠ê ‡§Ö‡§Ç‡§ï:</span>
                    <span id="scoreValue">0</span>
                </div>
                <div class="score-item">
                    <span>üèÜ ‡§∏‡•ç‡§§‡§∞:</span>
                    <span id="levelValue">1</span>
                </div>
            </div>
        </div>

        <div class="lesson-content" id="lessonContent">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon">üèÜ</div>
        <div class="achievement-text">
            <div class="achievement-title" id="achievementTitle">‡§â‡§™‡§≤‡§¨‡•ç‡§ß‡§ø ‡§Ö‡§®‡§≤‡•â‡§ï!</div>
            <div class="achievement-desc" id="achievementDesc">‡§Ü‡§™‡§®‡•á ‡§è‡§ï ‡§®‡§à ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ ‡§Æ‡•á‡§Ç ‡§Æ‡§π‡§æ‡§∞‡§§ ‡§π‡§æ‡§∏‡§ø‡§≤ ‡§ï‡•Ä</div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•á!</h2>
            <p class="modal-text" id="modalText">‡§Ü‡§™‡§®‡•á ‡§Ø‡§π ‡§ñ‡§Ç‡§° ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ</p>
            <button class="action-btn" onclick="closeModal()">‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            currentStage: null,
            score: 0,
            level: 1,
            completedLessons: [],
            unlockedAchievements: [],
            karmaKnowledge: {
                types: [],
                states: [],
                causes: []
            },
            masterUnlocked: false,
            stageProgress: {
                1: 0,
                2: 0,
                3: 0,
                4: 0
            }
        };

        // Karma Data - Based on Scriptural Text
        const karmaData = {
            types: [
                {
                    id: 'jnanavarana',
                    name: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§ú‡•ç‡§û‡§æ‡§® ‡§ó‡•Å‡§£ ‡§ï‡•ã ‡§¢‡§ï‡§§‡§æ ‡§π‡•à',
                    function: '‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§ú‡•ç‡§û‡§æ‡§® ‡§ó‡•Å‡§£ ‡§ï‡•ã ‡§Ü‡§µ‡•É‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§¶‡•á‡§µ‡§§‡§æ ‡§ï‡•á ‡§Æ‡•Å‡§ñ ‡§™‡§∞ ‡§¢‡§ï‡•á ‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üé≠',
                    color: '#6B46C1',
                    causes: [
                        '‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ó‡•Å‡§∞‡•Å ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§õ‡§ø‡§™‡§æ‡§®‡§æ',
                        '‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§ß‡§æ ‡§°‡§æ‡§≤‡§®‡§æ',
                        '‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§´‡§æ‡§°‡§º ‡§¶‡•á‡§®‡§æ, ‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§ï‡•Ä ‡§ö‡•ã‡§∞‡•Ä ‡§ï‡§∞‡§®‡§æ',
                        '‡§ú‡•ç‡§û‡§æ‡§® ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä ‡§à‡§∞‡•ç‡§∑‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§ú‡•ç‡§û‡§æ‡§® ‡§® ‡§¶‡•á‡§®‡§æ',
                        '‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø ‡§ï‡§∞‡§®‡§æ'
                    ],
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§¨‡§æ‡§π‡•Å‡§¨‡§≤‡•Ä ‡§ú‡•à‡§∏‡•á ‡§Æ‡§π‡§æ‡§™‡§∞‡§æ‡§ï‡•ç‡§∞‡§Æ‡•Ä ‡§ï‡•ã ‡§è‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§§‡§ï ‡§ñ‡§°‡§º‡§æ ‡§∞‡§ñ‡§æ ‡§ï‡•á‡§µ‡§≤‡§ú‡•ç‡§û‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§®‡•á ‡§¶‡§ø‡§Ø‡§æ'
                },
                {
                    id: 'darshanavarana',
                    name: '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§¶‡§∞‡•ç‡§∂‡§® ‡§ó‡•Å‡§£ ‡§ï‡•ã ‡§¢‡§ï‡§§‡§æ ‡§π‡•à',
                    function: '‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•Ä ‡§¶‡§∞‡•ç‡§∂‡§® ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§Ü‡§µ‡•É‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üö™',
                    color: '#9333EA',
                    causes: [
                        '‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•ã‡§®‡§æ',
                        '‡§Ü‡§≤‡§∏‡•ç‡§Ø',
                        '‡§®‡§æ‡§∏‡•ç‡§§‡§ø‡§ï‡§§‡§æ',
                        '‡§∏‡§Æ‡•ç‡§Ø‡§ó‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§Æ‡•á‡§Ç ‡§¶‡•Ç‡§∑‡§£ ‡§≤‡§ó‡§æ‡§®‡§æ',
                        '‡§ï‡•Å‡§§‡•Ä‡§∞‡•ç‡§• ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ'
                    ],
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ø‡§•‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§§ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§µ‡§æ‡§≤‡•á ‡§ï‡•ã ‡§≠‡•Ä ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§®‡•á ‡§¶‡§ø‡§Ø‡§æ'
                },
                {
                    id: 'vedaniya',
                    name: '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§∏‡•Å‡§ñ-‡§¶‡•Å‡§É‡§ñ ‡§ï‡§æ ‡§µ‡•á‡§¶‡§® (‡§Ö‡§®‡•Å‡§≠‡•Ç‡§§‡§ø) ‡§ï‡§∞‡§æ‡§§‡§æ ‡§π‡•à',
                    function: '‡§∏‡•Å‡§ñ ‡§î‡§∞ ‡§¶‡•Å‡§É‡§ñ ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§≠‡•Ç‡§§‡§ø ‡§ï‡§∞‡§æ‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§∂‡§ï‡•ç‡§ï‡§∞ ‡§ï‡•Ä ‡§ö‡§æ‡§∂‡§®‡•Ä ‡§∏‡•á ‡§≤‡§™‡•á‡§ü‡•Ä ‡§§‡§≤‡§µ‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: '‚öîÔ∏è',
                    color: '#F59E0B',
                    causes: {
                        ‡§∏‡§æ‡§§‡§æ: ['‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§æ‡§£‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§Ö‡§®‡•Å‡§ï‡§Æ‡•ç‡§™‡§æ', '‡§¶‡§æ‡§® ‡§¶‡•á‡§®‡§æ', '‡§π‡•É‡§¶‡§Ø ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§®‡•ç‡§§‡§ø ‡§∞‡§ñ‡§®‡§æ'],
                        ‡§Ö‡§∏‡§æ‡§§‡§æ: ['‡§¶‡•Å‡§É‡§ñ, ‡§∂‡•ã‡§ï, ‡§§‡§æ‡§™', '‡§µ‡§ß ‡§î‡§∞ ‡§™‡§∞‡§ø‡§¶‡•á‡§µ‡§®', '‡§ï‡•ç‡§∞‡•Ç‡§∞‡§§‡§æ']
                    },
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§∂‡•ç‡§∞‡•Ä‡§™‡§æ‡§≤ ‡§ú‡•à‡§∏‡•á ‡§ï‡•ã‡§ü‡§ø‡§≠‡§ü‡•ç‡§ü ‡§ï‡•ã ‡§ï‡•ã‡§¢‡§º‡•Ä ‡§¨‡§®‡§æ‡§ï‡§∞ ‡§®‡§ø‡§ï‡§≤‡§µ‡§æ‡§Ø‡§æ, ‡§Æ‡•Å‡§®‡§ø ‡§µ‡§æ‡§¶‡§ø‡§∞‡§æ‡§ú ‡§ï‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡•å ‡§µ‡§∞‡•ç‡§∑ ‡§§‡§ï ‡§ï‡•Å‡§∑‡•ç‡§† ‡§∞‡•ã‡§ó ‡§ï‡§∞‡§æ‡§Ø‡§æ'
                },
                {
                    id: 'mohaniya',
                    name: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§∏‡§Æ‡•ç‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§ó‡•Å‡§£ ‡§ï‡•ã ‡§ò‡§æ‡§§‡§§‡§æ ‡§π‡•à',
                    function: '‡§∏‡§Æ‡•ç‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§Ü‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§Æ‡§¶‡§ø‡§∞‡§æ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üå™Ô∏è',
                    color: '#EF4444',
                    causes: [
                        '‡§ï‡•á‡§µ‡§≤‡•Ä ‡§≠‡§ó‡§µ‡§æ‡§®‡•ç, ‡§∂‡•ç‡§∞‡•Å‡§§, ‡§∏‡§Ç‡§ò ‡§Æ‡•á‡§Ç ‡§ù‡•Ç‡§†‡•á ‡§¶‡•ã‡§∑ ‡§≤‡§ó‡§æ‡§®‡§æ',
                        '‡§ï‡§∑‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ',
                        '‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•ã ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§≤‡•á‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§®‡§æ',
                        '‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§∏‡•á ‡§≠‡•ç‡§∞‡§∑‡•ç‡§ü ‡§ï‡§∞‡§®‡§æ'
                    ],
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§∞‡§æ‡§Æ ‡§ú‡•à‡§∏‡•á ‡§Æ‡§π‡§æ‡§®‡•ç ‡§™‡•Å‡§∞‡•Å‡§∑ ‡§ï‡•ã ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡§£ ‡§ï‡•á ‡§Æ‡•É‡§§‡§ï ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•ã ‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï ‡§ï‡§Ç‡§ß‡•á ‡§™‡§∞ ‡§∞‡§ñ‡§ï‡§∞ ‡§ò‡•Å‡§Æ‡§µ‡§æ‡§Ø‡§æ, ‡§∏‡•Ä‡§§‡§æ ‡§ï‡•Ä ‡§ú‡§ô‡•ç‡§ó‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡§æ‡§à'
                },
                {
                    id: 'ayu',
                    name: '‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§™‡•ç‡§∞‡§æ‡§£‡•Ä ‡§ï‡•ã ‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø ‡§Ü‡§¶‡§ø ‡§ï‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡•ã‡§ï‡•á ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à',
                    function: '‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Ç‡§ß‡•á ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§¨‡•á‡§°‡§º‡•Ä ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: '‚õìÔ∏è',
                    color: '#10B981',
                    causes: {
                        ‡§®‡§∞‡§ï‡§æ‡§Ø‡•Å: '‡§¨‡§π‡•Å‡§§ ‡§Ü‡§∞‡§Æ‡•ç‡§≠ ‡§è‡§µ‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§™‡§∞‡§ø‡§ó‡•ç‡§∞‡§π',
                        ‡§§‡§ø‡§∞‡•ç‡§Ø‡§û‡•ç‡§ö‡§æ‡§Ø‡•Å: '‡§Æ‡§æ‡§Ø‡§æ‡§ö‡§æ‡§∞‡•Ä, ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§ò‡§æ‡§§',
                        ‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§æ‡§Ø‡•Å: '‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§∏‡•á ‡§Æ‡•É‡§¶‡•Å‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ‡•Ä, ‡§Ö‡§≤‡•ç‡§™ ‡§Ü‡§∞‡§Æ‡•ç‡§≠, ‡§Ö‡§≤‡•ç‡§™ ‡§™‡§∞‡§ø‡§ó‡•ç‡§∞‡§π',
                        ‡§¶‡•á‡§µ‡§æ‡§Ø‡•Å: '‡§∏‡§Ç‡§Ø‡§Æ ‡§™‡§æ‡§≤‡§®, ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡§Æ‡§Ç‡§¶‡§§‡§æ, ‡§¶‡§æ‡§® ‡§¶‡•á‡§®‡§æ'
                    },
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§ú‡•à‡§∏‡•á ‡§ï‡•ç‡§∑‡§æ‡§Ø‡§ø‡§ï ‡§∏‡§Æ‡•ç‡§Ø‡§ó‡•ç‡§¶‡•É‡§∑‡•ç‡§ü‡§ø ‡§ï‡•ã ‡§è‡§µ‡§Ç ‡§∞‡§æ‡§µ‡§£ ‡§ï‡•ã ‡§≠‡•Ä ‡§®‡§∞‡§ï ‡§Æ‡•á‡§Ç ‡§∞‡•ã‡§ï ‡§∞‡§ñ‡§æ ‡§π‡•à'
                },
                {
                    id: 'nama',
                    name: '‡§®‡§æ‡§Æ ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§®‡§æ‡§Æ ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§Ö‡§ö‡•ç‡§õ‡•á-‡§¨‡•Å‡§∞‡•á ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•Ä ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    function: '‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§∞‡•Ç‡§™ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§ö‡§ø‡§§‡•ç‡§∞‡§ï‡§æ‡§∞ (‡§™‡•á‡§Ç‡§ü‡§∞) ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üé®',
                    color: '#8B5CF6',
                    causes: {
                        ‡§Ö‡§∂‡•Å‡§≠: '‡§Æ‡§®, ‡§µ‡§ö‡§®, ‡§ï‡§æ‡§Ø ‡§ï‡•Ä ‡§ï‡•Å‡§ü‡§ø‡§≤‡§§‡§æ, ‡§ö‡•Å‡§ó‡§≤‡§ñ‡•ã‡§∞‡•Ä, ‡§ß‡•ã‡§ñ‡§æ ‡§¶‡•á‡§®‡§æ',
                        ‡§∂‡•Å‡§≠: '‡§Æ‡§®, ‡§µ‡§ö‡§®, ‡§ï‡§æ‡§Ø ‡§ï‡•Ä ‡§∏‡§∞‡§≤‡§§‡§æ, ‡§ö‡§ø‡§§‡•ç‡§§ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§∞‡§§‡§æ',
                        ‡§§‡•Ä‡§∞‡•ç‡§•‡§ô‡•ç‡§ï‡§∞: '‡§∏‡•ã‡§≤‡§π‡§ï‡§æ‡§∞‡§£ ‡§≠‡§æ‡§µ‡§®‡§æ'
                    },
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ö‡§®‡•á‡§ï ‡§ï‡•ã ‡§ó‡•Ç‡§Å‡§ó‡§æ, ‡§ï‡•Å‡§¨‡§°‡§º‡§æ, ‡§ï‡§æ‡§≤‡§æ, ‡§Ö‡§∑‡•ç‡§ü‡§æ‡§µ‡§ï‡•ç‡§∞ ‡§¨‡§®‡§æ‡§Ø‡§æ'
                },
                {
                    id: 'gotra',
                    name: '‡§ó‡•ã‡§§‡•ç‡§∞ ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§ó‡•ã‡§§‡•ç‡§∞ ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§ú‡•Ä‡§µ ‡§ï‡•ã ‡§®‡•Ä‡§ö ‡§µ ‡§â‡§ö‡•ç‡§ö ‡§ó‡•ã‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à',
                    function: '‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§î‡§∞ ‡§ï‡•Å‡§≤ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§ï‡•Å‡§Æ‡•ç‡§≠‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üè∫',
                    color: '#059669',
                    causes: {
                        ‡§â‡§ö‡•ç‡§ö: '‡§Ö‡§™‡§®‡•Ä ‡§®‡§ø‡§Ç‡§¶‡§æ, ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ, ‡§µ‡§ø‡§®‡§Æ‡•ç‡§∞‡§§‡§æ',
                        ‡§®‡•Ä‡§ö: '‡§™‡§∞‡§®‡§ø‡§Ç‡§¶‡§æ, ‡§Ü‡§§‡•ç‡§Æ ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ, ‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞'
                    },
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§¨‡§π‡•Å‡§§‡•ã‡§Ç ‡§ï‡•ã ‡§ä‡§Å‡§ö-‡§®‡•Ä‡§ö ‡§ï‡•Å‡§≤ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§æ'
                },
                {
                    id: 'antaraya',
                    name: '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    hindi: '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø ‡§ï‡§∞‡•ç‡§Æ',
                    description: '‡§ú‡•ã ‡§¶‡§æ‡§®, ‡§≤‡§æ‡§≠, ‡§≠‡•ã‡§ó, ‡§â‡§™‡§≠‡•ã‡§ó ‡§è‡§µ‡§Ç ‡§µ‡•Ä‡§∞‡•ç‡§Ø ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ò‡•ç‡§® ‡§°‡§æ‡§≤‡§§‡§æ ‡§π‡•à',
                    function: '‡§¶‡§æ‡§®, ‡§≤‡§æ‡§≠ ‡§î‡§∞ ‡§≠‡•ã‡§ó ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§ß‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    analogy: '‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                    icon: 'üîí',
                    color: '#DC2626',
                    causes: [
                        '‡§¶‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§ß‡§æ ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ',
                        '‡§ú‡§ø‡§® ‡§™‡•Ç‡§ú‡§æ ‡§ï‡§æ ‡§®‡§ø‡§∑‡•á‡§ß ‡§ï‡§∞‡§®‡§æ',
                        '‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§≤‡•ç‡§Ø ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§ï‡§æ ‡§∏‡•á‡§µ‡§® ‡§ï‡§∞‡§®‡§æ',
                        '‡§Ö‡§™‡§®‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§õ‡§ø‡§™‡§æ‡§®‡§æ'
                    ],
                    story: '‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§Æ‡•Å‡§®‡§ø ‡§ï‡•ã ‡•≠ ‡§Æ‡§æ‡§π ‡•Ø ‡§¶‡§ø‡§® ‡§§‡§ï ‡§Ü‡§π‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§®‡•á ‡§¶‡§ø‡§Ø‡§æ'
                }
            ],
            states: [
                {
                    name: '‡§¨‡§Ç‡§ß',
                    hindi: '‡§¨‡§Ç‡§ß',
                    description: '‡§¶‡•ç‡§µ‡§ø‡§§‡•ç‡§µ ‡§ï‡§æ ‡§§‡•ç‡§Ø‡§æ‡§ó ‡§ï‡§∞‡§ï‡•á ‡§è‡§ï‡§§‡•ç‡§µ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ø - ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß‡§®',
                    example: '‡•ß‡•¶ ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•å‡§ï‡§∞‡•Ä ‡§™‡§ï‡•ç‡§ï‡•Ä ‡§π‡•ã ‡§ú‡§æ‡§®‡§æ',
                    gunsthana: '‡•ß-‡•ß‡•©'
                },
                {
                    name: '‡§∏‡§§‡•ç‡§§‡•ç‡§µ',
                    hindi: '‡§∏‡§§‡•ç‡§§‡•ç‡§µ',
                    description: '‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§î‡§∞ ‡§´‡§≤ ‡§¶‡•á‡§®‡•á ‡§∏‡•á ‡§™‡•Ç‡§∞‡•ç‡§µ ‡§¨‡•Ä‡§ö ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                    example: '‡§®‡•å‡§ï‡§∞‡•Ä ‡§Æ‡§ø‡§≤‡§®‡•á ‡§î‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ï‡§æ ‡§∏‡§Æ‡§Ø',
                    gunsthana: '‡•ß-‡•ß‡•™'
                },
                {
                    name: '‡§â‡§¶‡§Ø',
                    hindi: '‡§â‡§¶‡§Ø',
                    description: '‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø, ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞, ‡§ï‡§æ‡§≤ ‡§î‡§∞ ‡§≠‡§æ‡§µ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡§æ ‡§´‡§≤ ‡§¶‡•á‡§®‡§æ',
                    example: '‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§®‡•å‡§ï‡§∞‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ',
                    gunsthana: '‡•ß-‡•ß‡•™'
                },
                {
                    name: '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ',
                    hindi: '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ',
                    description: '‡§Ü‡§¨‡§æ‡§ß‡§æ ‡§ï‡§æ‡§≤ ‡§ï‡•á ‡§™‡•Ç‡§∞‡•ç‡§µ ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§¶‡§Ø ‡§Æ‡•á‡§Ç ‡§Ü ‡§ú‡§æ‡§®‡§æ',
                    example: '‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§®‡•å‡§ï‡§∞‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ',
                    gunsthana: '‡•ß-‡•ß‡•©'
                },
                {
                    name: '‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£',
                    hindi: '‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£',
                    description: '‡§™‡•Ç‡§∞‡•ç‡§µ ‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§≠‡§æ‡§ó ‡§Æ‡•á‡§Ç ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø',
                    example: '‡§®‡•å‡§ï‡§∞‡•Ä ‡•ß‡•¶ ‡§∏‡•á ‡•ß‡•ß ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§¢‡§º ‡§ú‡§æ‡§®‡§æ',
                    gunsthana: '‡•ß-‡•ß‡•©'
                },
                {
                    name: '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£',
                    hindi: '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£',
                    description: '‡§™‡•Ç‡§∞‡•ç‡§µ‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§µ ‡§Ö‡§®‡•Å‡§≠‡§æ‡§ó ‡§Æ‡•á‡§Ç ‡§π‡§æ‡§®‡§ø',
                    example: '‡§®‡•å‡§ï‡§∞‡•Ä ‡•ß‡•¶ ‡§∏‡•á ‡•Ø ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§Æ ‡§π‡•ã ‡§ú‡§æ‡§®‡§æ',
                    gunsthana: '‡•ß-‡•ß‡•©'
                },
                {
                    name: '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£',
                    hindi: '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£',
                    description: '‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø ‡§∞‡•Ç‡§™ ‡§™‡§∞‡§ø‡§£‡§Æ‡§®',
                    example: '‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§´‡•à‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§£',
                    gunsthana: '‡•ß-‡•ß‡•¶'
                },
                {
                    name: '‡§â‡§™‡§∂‡§Æ',
                    hindi: '‡§â‡§™‡§∂‡§Æ',
                    description: '‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§â‡§¶‡§Ø ‡§Æ‡•á‡§Ç ‡§® ‡§Ü‡§®‡§æ, ‡§µ‡§ø‡§®‡§æ‡§∂ ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ ‡§¶‡§Æ‡§®',
                    example: '‡§´‡•à‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§Ç‡§¶, ‡§ö‡§æ‡§¨‡•Ä ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞',
                    gunsthana: '‡•ß-‡•Æ'
                },
                {
                    name: '‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø',
                    hindi: '‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø',
                    description: '‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§â‡§¶‡§Ø‡§æ‡§µ‡§≤‡•Ä ‡§Æ‡•á‡§Ç ‡§≤‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§∏‡§Æ‡§∞‡•ç‡§•‡§§‡§æ',
                    example: '‡§∏‡§Æ‡§Ø ‡§Ø‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á',
                    gunsthana: '‡•ß-‡•Æ'
                },
                {
                    name: '‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§',
                    hindi: '‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§',
                    description: '‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§Ö‡§∏‡§Ç‡§≠‡§µ',
                    example: '‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§, ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§∏‡§Ç‡§≠‡§µ ‡§®‡§π‡•Ä‡§Ç',
                    gunsthana: '‡•ß-‡•Æ'
                }
            ],
            historicalCases: [
                {
                    title: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§ï‡§æ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®',
                    description: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§®‡•á ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§Æ‡•á‡§Ç ‡•©‡•© ‡§∏‡§æ‡§ó‡§∞ ‡§ï‡•Ä ‡§®‡§∞‡§ï‡§æ‡§Ø‡•Å ‡§¨‡§æ‡§Ç‡§ß‡•Ä ‡§•‡•Ä, ‡§≤‡•á‡§ï‡§ø‡§® ‡§ï‡•ç‡§∑‡§æ‡§Ø‡§ø‡§ï ‡§∏‡§Æ‡•ç‡§Ø‡§ó‡•ç‡§¶‡§∞‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§á‡§∏‡•á ‡•Æ‡•™,‡•¶‡•¶‡•¶ ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ‡•§',
                    karmaState: '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£',
                    lesson: '‡§∂‡•Å‡§≠ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡•ã‡§Ç ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§ï‡§Æ‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§'
                },
                {
                    title: '‡§ñ‡§¶‡§ø‡§∞‡§∏‡§æ‡§∞ ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£',
                    description: '‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞‡§∏‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§ñ‡§¶‡§ø‡§∞‡§∏‡§æ‡§∞ ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Ü‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§∏‡§ø‡§¶‡•ç‡§ß ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à‡•§',
                    karmaState: '‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£',
                    lesson: '‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§ï‡§∑‡§æ‡§Ø ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§¨‡§¢‡§º ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§'
                },
                {
                    title: '‡§ú‡§ø‡§®‡§¨‡§ø‡§Æ‡•ç‡§¨ ‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ',
                    description: '‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§µ‡•Ä‡§∞‡§∏‡•á‡§® ‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç - ‡§ú‡§ø‡§®‡§¨‡§ø‡§Æ‡•ç‡§¨ ‡§ï‡•á ‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡•á ‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø ‡§î‡§∞ ‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§≠‡•Ä ‡§Æ‡§ø‡§•‡•ç‡§Ø‡§æ‡§§‡•ç‡§µ‡§æ‡§¶‡§ø ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§ï‡•ç‡§∑‡§Ø ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§',
                    karmaState: '‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø/‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§',
                    lesson: '‡§™‡§µ‡§ø‡§§‡•ç‡§∞ ‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡•á ‡§Ö‡§ü‡§≤ ‡§ï‡§∞‡•ç‡§Æ ‡§≠‡•Ä ‡§®‡§∑‡•ç‡§ü ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§'
                }
            ]
        };

        // Initialize
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainMenu').classList.add('active');
            }, 2000);
            
            // Load saved progress
            loadProgress();
            checkMasterUnlock();
        };
        // Check if master challenge should be unlocked
        function checkMasterUnlock() {
            const totalProgress = gameState.stageProgress[1] + gameState.stageProgress[2] + gameState.stageProgress[3];
            
            if (totalProgress >= 250 && !gameState.masterUnlocked) { // All three stages completed
                gameState.masterUnlocked = true;
                const masterCard = document.getElementById('masterStage');
                if (masterCard) {
                    masterCard.classList.remove('locked');
                    showAchievement('‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§Ö‡§®‡§≤‡•â‡§ï!', '‡§Ö‡§¨ ‡§Ü‡§™ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡§Ç!');
                }
            }
            
            // Update the visual state of master stage
            const masterCard = document.getElementById('masterStage');
            if (masterCard && gameState.masterUnlocked) {
                masterCard.classList.remove('locked');
            }
        }

        // Start Stage
        function startStage(stage) {
            gameState.currentStage = stage;
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            switch(stage) {
                case 1:
                    loadStage1();
                    break;
                case 2:
                    loadStage2();
                    break;
                case 3:
                    loadStage3();
                    break;
            }
        }

        // Stage 1: Anatomy of Karma
        function loadStage1() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section fade-in">
                    <h2 class="section-title">
                        <span>üìø</span>
                        <span>‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§Ü‡§† ‡§Ü‡§µ‡§∞‡§£</span>
                    </h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        ‡§∏‡§Ç‡§∏‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞ ‡§π‡•à ‡§§‡•ã ‡§µ‡§π ‡§π‡•à ‡§ï‡§∞‡•ç‡§Æ‡•§ ‡§Æ‡•Å‡§®‡§ø ‡§π‡•ã, ‡§∂‡•ç‡§∞‡§æ‡§µ‡§ï ‡§π‡•ã, ‡§∞‡§æ‡§ú‡§æ ‡§π‡•ã ‡§Ø‡§æ ‡§∞‡§Ç‡§ï, 
                        ‡§Ø‡•Å‡§µ‡§æ ‡§π‡•ã ‡§Ø‡§æ ‡§µ‡•É‡§¶‡•ç‡§ß, ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§ï‡•ç‡§∑‡§™‡§æ‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ ‡§ú‡•Ä‡§µ ‡§ú‡•à‡§∏‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§µ‡•à‡§∏‡§æ ‡§π‡•Ä ‡§â‡§∏‡•á ‡§´‡§≤ ‡§Æ‡§ø‡§≤‡§§‡§æ ‡§π‡•à‡•§ 
                        ‡§Ü‡§á‡§Ø‡•á ‡§ú‡§æ‡§®‡•á‡§Ç ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Ç‡§ß‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡•Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•ã‡•§
                    </p>
                    
                    <div class="soul-container">
                        <div class="soul-avatar" id="soulAvatar">
                            <div class="karma-layer" id="layer1" style="background: rgba(107,70,193,0.3);"></div>
                            <div class="karma-layer" id="layer2" style="background: rgba(147,51,234,0.3);"></div>
                            <div class="karma-layer" id="layer3" style="background: rgba(245,158,11,0.3);"></div>
                            <div class="karma-layer" id="layer4" style="background: rgba(239,68,68,0.3);"></div>
                        </div>
                    </div>
                    
                    <div class="karma-grid" id="karmaGrid">
                        ${karmaData.types.map(karma => `
                            <div class="karma-card" onclick="selectKarma('${karma.id}')" data-karma="${karma.id}">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">${karma.icon}</div>
                                <div class="karma-name">${karma.name}</div>
                                <div class="karma-description">${karma.description}</div>
                                <div class="karma-analogy">"${karma.analogy}"</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startKarmaCatcher()">‡§ï‡§∞‡•ç‡§Æ ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡§æ ‡§ñ‡•á‡§≤ üéÆ</button>
                        <button class="action-btn" onclick="showKarmaQuiz()">‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ üìù</button>
                        <button class="action-btn" onclick="showKarmaStories()">‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§•‡§æ‡§è‡§Ç üìö</button>
                        <button class="action-btn" onclick="startMemoryGame()">‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§ñ‡•á‡§≤ üß†</button>
                    </div>
                </div>
            `;
        }

        // Stage 2: Lifecycle of Karma
        function loadStage2() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section fade-in">
                    <h2 class="section-title">
                        <span>üîÑ</span>
                        <span>‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§¶‡§∏ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç</span>
                    </h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        ‡§ï‡§∞‡•ç‡§Æ ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à - ‡§Ø‡§π ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®‡•ã‡§Ç ‡§∏‡•á ‡§ó‡•Å‡§ú‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§ú‡•à‡§∏‡•á ‡§®‡•å‡§ï‡§∞‡•Ä ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§¨‡§Ç‡§ß ‡§ú‡§ø‡§∏‡•á 
                        ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§, ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞‡§ø‡§§ ‡§Ø‡§æ ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡•ß‡•¶ ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç ‡§π‡•à‡§Ç‡•§
                    </p>
                    
                    <div class="karma-state-timeline">
                        <div class="timeline-line"></div>
                        ${karmaData.states.map((state, index) => `
                            <div class="timeline-item slide-up" style="animation-delay: ${index * 0.1}s">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <h3 style="color: var(--primary); margin-bottom: 0.5rem;">
                                        ${state.name} (${state.hindi})
                                    </h3>
                                    <p style="margin-bottom: 0.5rem;">${state.description}</p>
                                    <p style="font-style: italic; color: var(--accent);">
                                        ‡§â‡§¶‡§æ‡§π‡§∞‡§£: ${state.example}
                                    </p>
                                    <small style="color: var(--dark); opacity: 0.7;">
                                        ‡§ó‡•Å‡§£‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø: ${state.gunsthana}
                                    </small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startKarmaSimulator()">‡§ï‡§∞‡•ç‡§Æ ‡§™‡•ç‡§∞‡§µ‡§æ‡§π ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü‡§∞ üéØ</button>
                        <button class="action-btn" onclick="showCaseStudies()">‡§ê‡§§‡§ø‡§π‡§æ‡§∏‡§ø‡§ï ‡§â‡§¶‡§æ‡§π‡§∞‡§£ üìñ</button>
                        <button class="action-btn" onclick="testKarmaStates()">‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä üé≤</button>
                        <button class="action-btn" onclick="startDragDropGame()">‡§ï‡•ç‡§∞‡§Æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§ñ‡•á‡§≤ üéØ</button>
                    </div>
                </div>
            `;
        }

        // Stage 3: ƒÄyu Karma Special
        function loadStage3() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section fade-in">
                    <h2 class="section-title">
                        <span>‚è≥</span>
                        <span>‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ: ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§ï‡§æ ‡§∞‡§π‡§∏‡•ç‡§Ø</span>
                    </h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        ‡§∏‡§æ‡§§ ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡§æ ‡§¨‡§Ç‡§ß ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Æ‡§Ø ‡§π‡•ã‡§§‡§æ ‡§∞‡§π‡§§‡§æ ‡§π‡•à ‡§ï‡§ø‡§®‡•ç‡§§‡•Å ‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§π‡•Ä ‡§¨‡§Ç‡§ß‡§§‡§æ ‡§π‡•à‡•§
                        ‡§Ø‡§π ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§∂‡§∞‡•Ä‡§∞ ‡§î‡§∞ ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§§‡§®‡•á ‡§∏‡§Æ‡§Ø ‡§§‡§ï ‡§∞‡§π‡§§‡•Ä ‡§π‡•à‡•§
                    </p>
                    
                    <div class="lesson-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                        <h3 style="color: var(--primary); margin-bottom: 1rem;">‡•Æ ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑ ‡§ï‡§æ‡§≤</h3>
                        <p style="margin-bottom: 1rem;">
                            ‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§¨‡§Ç‡§ß ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡•Æ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§µ‡§∏‡§∞‡•ã‡§Ç ‡§™‡§∞ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ 
                            ‡§á‡§∏‡•á ‡§ê‡§∏‡•á ‡§∏‡§Æ‡§ù‡•á‡§Ç ‡§ú‡•à‡§∏‡•á ‡§∞‡•á‡§≤ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§∏‡§æ‡§∞‡§£‡•Ä - ‡§Ü‡§™ ‡§ï‡•á‡§µ‡§≤ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§∏‡•ç‡§ü‡•á‡§∂‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§π‡•Ä ‡§ö‡§¢‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
                        </p>
                        
                        <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h4>‡•≠‡•®‡•Ø ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è:</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 0.5rem; border-bottom: 1px solid #eee;">
                                    1Ô∏è‚É£ ‡•™‡•Æ‡•¨ ‡§µ‡§∞‡•ç‡§∑ ‡§™‡§∞ (‡•®/‡•© ‡§¨‡§ø‡§Ç‡§¶‡•Å): ‡§™‡•ç‡§∞‡§•‡§Æ ‡§Ö‡§µ‡§∏‡§∞
                                </li>
                                <li style="padding: 0.5rem; border-bottom: 1px solid #eee;">
                                    2Ô∏è‚É£ ‡•¨‡•™‡•Æ ‡§µ‡§∞‡•ç‡§∑ ‡§™‡§∞: ‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø ‡§Ö‡§µ‡§∏‡§∞
                                </li>
                                <li style="padding: 0.5rem; border-bottom: 1px solid #eee;">
                                    3Ô∏è‚É£ ‡•≠‡•¶‡•® ‡§µ‡§∞‡•ç‡§∑ ‡§™‡§∞: ‡§§‡•É‡§§‡•Ä‡§Ø ‡§Ö‡§µ‡§∏‡§∞
                                </li>
                                <li style="padding: 0.5rem;">
                                    ...‡§î‡§∞ ‡§á‡§∏‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞, ‡§∂‡•á‡§∑ ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡•®/‡•© ‡§≠‡§æ‡§ó ‡§™‡§∞
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="lesson-section" style="background: linear-gradient(135deg, #fee2e2 0%, #fca5a5 100%);">
                        <h3 style="color: var(--primary); margin-bottom: 1rem;">‡§Ö‡§ï‡§æ‡§≤ ‡§Æ‡§∞‡§£</h3>
                        <p style="margin-bottom: 1rem;">
                            ‡§ú‡•à‡§∏‡•á ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§ò‡§°‡§º‡§æ ‡§∏‡•ç‡§µ‡§æ‡§≠‡§æ‡§µ‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ü‡•Ç‡§ü ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, 
                            ‡§µ‡•à‡§∏‡•á ‡§π‡•Ä ‡§ú‡•Ä‡§µ‡§® ‡§á‡§® ‡§ï‡§æ‡§∞‡§£‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                ‚ò†Ô∏è ‡§µ‡§ø‡§∑
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                ü©∏ ‡§∞‡§ï‡•ç‡§§‡§ï‡•ç‡§∑‡§Ø
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                üò® ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§≠‡§Ø
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                ‚öîÔ∏è ‡§∂‡§∏‡•ç‡§§‡•ç‡§∞
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                üò∞ ‡§∏‡§Ç‡§ï‡•ç‡§≤‡•á‡§∂
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                üí® ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ö‡§µ‡§∞‡•ã‡§ß
                            </div>
                        </div>
                        <p style="margin-top: 1rem; font-style: italic;">
                            ‡§®‡•ã‡§ü: ‡§Ø‡§π ‡§ï‡•á‡§µ‡§≤ ‡§ï‡§∞‡•ç‡§Æ‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•á ‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§§‡§ø‡§∞‡•ç‡§Ø‡§Ç‡§ö‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à, 
                            ‡§¶‡•á‡§µ ‡§Ø‡§æ ‡§®‡§æ‡§∞‡§ï‡•Ä ‡§ú‡•Ä‡§µ‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç‡•§
                        </p>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startLifespanCalculator()">‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§ó‡§£‡§ï üßÆ</button>
                        <button class="action-btn" onclick="showDeathTransition()">‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ üåü</button>
                        <button class="action-btn" onclick="ayuQuiz()">‡§Ü‡§Ø‡•Å ‡§ö‡•Å‡§®‡•å‡§§‡•Ä üìã</button>
                        <button class="action-btn" onclick="startVigrahGatiGame()">‡§µ‡§ø‡§ó‡•ç‡§∞‡§π ‡§ó‡§§‡§ø ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü‡§∞ üöÄ</button>
                    </div>
                </div>
            `;
        }

        // Historical Case Studies
        function showCaseStudies() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">üìñ ‡§ê‡§§‡§ø‡§π‡§æ‡§∏‡§ø‡§ï ‡§â‡§¶‡§æ‡§π‡§∞‡§£</h2>
                    <p style="margin-bottom: 2rem;">‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§£‡§ø‡§§ ‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§â‡§¶‡§æ‡§π‡§∞‡§£</p>
                    
                    ${karmaData.historicalCases.map((case_study, index) => `
                        <div class="case-study-card">
                            <h3 style="color: var(--primary); margin-bottom: 1rem;">${case_study.title}</h3>
                            <p style="margin-bottom: 1rem;">${case_study.description}</p>
                            <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                                <div>
                                    <strong>‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ:</strong> ${case_study.karmaState}
                                </div>
                                <div>
                                    <strong>‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ:</strong> ${case_study.lesson}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="loadStage2()">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
                        <button class="action-btn" onclick="startCaseStudyQuiz()">‡§ï‡•á‡§∏ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä</button>
                    </div>
                </div>
            `;
        }

        // Case Study Quiz
        function startCaseStudyQuiz() {
            const questions = [
                {
                    question: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§®‡•á ‡§ï‡§ø‡§∏ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§®‡§∞‡§ï‡§æ‡§Ø‡•Å ‡§ï‡§Æ ‡§ï‡•Ä?',
                    options: ['‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£', '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£', '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£', '‡§â‡§™‡§∂‡§Æ'],
                    correct: 1
                },
                {
                    question: '‡§ú‡§ø‡§®‡§¨‡§ø‡§Æ‡•ç‡§¨ ‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§®‡§∑‡•ç‡§ü ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?',
                    options: ['‡§ï‡•á‡§µ‡§≤ ‡§¨‡§Ç‡§ß', '‡§ï‡•á‡§µ‡§≤ ‡§∏‡§§‡•ç‡§§‡•ç‡§µ', '‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø ‡§î‡§∞ ‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§', '‡§ï‡•á‡§µ‡§≤ ‡§â‡§¶‡§Ø'],
                    correct: 2
                },
                {
                    question: '‡§ñ‡§¶‡§ø‡§∞‡§∏‡§æ‡§∞ ‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à?',
                    options: ['‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£', '‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£', '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ', '‡§â‡§™‡§∂‡§Æ'],
                    correct: 1
                }
            ];
            
            showQuiz(questions, '‡§ï‡•á‡§∏ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä');
        }

        // Test Karma States - Comprehensive Quiz
        function testKarmaStates() {
            const questions = [
                {
                    question: '‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§ï‡§ø‡§§‡§®‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç?',
                    options: ['‡•Æ', '‡•Ø', '‡•ß‡•¶', '‡•ß‡•®'],
                    correct: 2
                },
                {
                    question: '‡§ï‡•å‡§® ‡§∏‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡§∞‡•ç‡§Æ ‡§´‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§Æ‡•á‡§Ç ‡§∞‡§π‡§§‡§æ ‡§π‡•à?',
                    options: ['‡§¨‡§Ç‡§ß', '‡§∏‡§§‡•ç‡§§‡•ç‡§µ', '‡§â‡§¶‡§Ø', '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ'],
                    correct: 1
                },
                {
                    question: '‡§ï‡§ø‡§∏ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§∏‡§Ç‡§≠‡§µ ‡§®‡§π‡•Ä‡§Ç?',
                    options: ['‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø', '‡§â‡§™‡§∂‡§Æ', '‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§', '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£'],
                    correct: 2
                },
                {
                    question: '‡§¨‡§Ç‡§ß ‡§ï‡§∞‡§£ ‡§ï‡§ø‡§∏ ‡§ó‡•Å‡§£‡§∏‡•ç‡§•‡§æ‡§® ‡§§‡§ï ‡§π‡•ã‡§§‡§æ ‡§π‡•à?',
                    options: ['‡•Æ', '‡•ß‡•¶', '‡•ß‡•©', '‡•ß‡•™'],
                    correct: 2
                },
                {
                    question: '‡§´‡•à‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§Ç‡§¶ ‡§π‡•ã‡§®‡§æ ‡§ï‡§ø‡§∏ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à?',
                    options: ['‡§â‡§¶‡§Ø', '‡§â‡§™‡§∂‡§Æ', '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ', '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£'],
                    correct: 1
                }
            ];
            
            showQuiz(questions, '‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä');
        }

        // Master Challenge
        function startMasterChallenge() {
            if (!gameState.masterUnlocked) {
                showModal('‡§Ö‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç', '‡§™‡§π‡§≤‡•á ‡§∏‡§≠‡•Ä ‡§§‡•Ä‡§® ‡§ö‡§∞‡§£ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }
            
            gameState.currentStage = 4;
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">
                        <span>üéÆ</span>
                        <span>‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä</span>
                    </h2>
                    <p style="margin-bottom: 2rem;">
                        ‡§Ö‡§™‡§®‡•á ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•ç‡§Æ ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç! ‡§Ø‡§π ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§Ü‡§™‡§ï‡•á ‡§∏‡§≠‡•Ä ‡§∏‡•Ä‡§ñ‡•á ‡§ó‡§è ‡§™‡§æ‡§†‡•ã‡§Ç ‡§ï‡•ã ‡§™‡§∞‡§ñ‡•á‡§ó‡•Ä‡•§
                    </p>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startComprehensiveQuiz()">‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä üìù</button>
                        <button class="action-btn" onclick="startKarmaMatchChallenge()">‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡•à‡§ö ‡§ö‡•à‡§≤‡•á‡§Ç‡§ú üéØ</button>
                        <button class="action-btn" onclick="startTimedChallenge()">‡§∏‡§Æ‡§Ø ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‚è±Ô∏è</button>
                        <button class="action-btn" onclick="startScenarioAnalysis()">‡§™‡§∞‡§ø‡§¶‡•É‡§∂‡•ç‡§Ø ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ üîç</button>
                    </div>
                </div>
            `;
        }

        // Comprehensive Quiz
        function startComprehensiveQuiz() {
            const questions = [
                {
                    question: '‡§ò‡§æ‡§§‡§ø‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§ø‡§§‡§®‡•á ‡§π‡•à‡§Ç?',
                    options: ['‡•©', '‡•™', '‡•´', '‡•¨'],
                    correct: 1
                },
                {
                    question: '‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® ‡§π‡•à?',
                    options: ['‡§ó‡•ã‡§§‡•ç‡§∞', '‡§®‡§æ‡§Æ', '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø', '‡§Ü‡§Ø‡•Å'],
                    correct: 2
                },
                {
                    question: '‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§¨‡§Ç‡§ß ‡§ï‡§ø‡§§‡§®‡•á ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑ ‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à?',
                    options: ['‡•¨', '‡•≠', '‡•Æ', '‡•Ø'],
                    correct: 2
                },
                {
                    question: '‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§§‡§®‡•á ‡§∏‡§Æ‡§Ø ‡§≤‡§ó‡§§‡•á ‡§π‡•à‡§Ç?',
                    options: ['‡•ß', '‡•®', '‡•©', '‡•™'],
                    correct: 3
                },
                {
                    question: '‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§®‡•á ‡§¨‡§æ‡§π‡•Å‡§¨‡§≤‡•Ä ‡§ï‡•ã ‡§ï‡•á‡§µ‡§≤‡§ú‡•ç‡§û‡§æ‡§® ‡§∏‡•á ‡§∞‡•ã‡§ï‡§æ?',
                    options: ['‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£', '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø'],
                    correct: 0
                },
                {
                    question: '‡§∏‡•ã‡§≤‡§π‡§ï‡§æ‡§∞‡§£ ‡§≠‡§æ‡§µ‡§®‡§æ ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß‡§§‡§æ ‡§π‡•à?',
                    options: ['‡§â‡§ö‡•ç‡§ö ‡§ó‡•ã‡§§‡•ç‡§∞', '‡§§‡•Ä‡§∞‡•ç‡§•‡§Ç‡§ï‡§∞ ‡§®‡§æ‡§Æ', '‡§¶‡•á‡§µ‡§æ‡§Ø‡•Å', '‡§∏‡§æ‡§§‡§æ ‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø'],
                    correct: 1
                },
                {
                    question: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§®‡•á ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§Ø‡•Å ‡§ï‡§ø‡§§‡§®‡•Ä ‡§ï‡§∞ ‡§≤‡•Ä ‡§•‡•Ä?',
                    options: ['‡•©‡•© ‡§∏‡§æ‡§ó‡§∞', '‡•Æ‡•™ ‡§π‡§ú‡§æ‡§∞ ‡§µ‡§∞‡•ç‡§∑', '‡•ß ‡§™‡§≤‡•ç‡§Ø', '‡•≠ ‡§¶‡§ø‡§®'],
                    correct: 1
                },
                {
                    question: '‡§ï‡§ø‡§∏ ‡§ó‡§§‡§ø ‡§ï‡•á ‡§ú‡•Ä‡§µ‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§ï‡§æ‡§≤ ‡§Æ‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ?',
                    options: ['‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø', '‡§§‡§ø‡§∞‡•ç‡§Ø‡§Ç‡§ö', '‡§¶‡•á‡§µ ‡§î‡§∞ ‡§®‡§æ‡§∞‡§ï‡•Ä', '‡§∏‡§≠‡•Ä ‡§ï‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à'],
                    correct: 2
                }
            ];
            
            showQuiz(questions, '‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§ï‡§∞‡•ç‡§Æ ‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ', true);
        }

        // Memory Game
        function startMemoryGame() {
            const content = document.getElementById('lessonContent');
            const karmaPairs = karmaData.types.slice(0, 4).map(k => [k.icon, k.name]);
            const tiles = [...karmaPairs, ...karmaPairs].sort(() => Math.random() - 0.5);
            
            let flippedTiles = [];
            let matchedPairs = 0;
            
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">‡§ï‡§∞‡•ç‡§Æ ‡§∏‡•ç‡§Æ‡•É‡§§‡§ø ‡§ñ‡•á‡§≤</h2>
                    <p>‡§Æ‡§ø‡§≤‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§ö‡§ø‡§π‡•ç‡§® ‡§î‡§∞ ‡§®‡§æ‡§Æ</p>
                    
                    <div class="game-board">
                        ${tiles.map((tile, index) => `
                            <div class="game-tile" data-index="${index}" data-value="${tile}" onclick="flipTile(${index})">
                                ?
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            window.flipTile = function(index) {
                const tile = document.querySelector(`[data-index="${index}"]`);
                if (tile.classList.contains('matched') || tile.classList.contains('flipped')) return;
                
                tile.classList.add('flipped');
                tile.textContent = tiles[index];
                flippedTiles.push({index, value: tiles[index]});
                
                if (flippedTiles.length === 2) {
                    setTimeout(() => {
                        if (flippedTiles[0].value === flippedTiles[1].value) {
                            document.querySelector(`[data-index="${flippedTiles[0].index}"]`).classList.add('matched');
                            document.querySelector(`[data-index="${flippedTiles[1].index}"]`).classList.add('matched');
                            matchedPairs++;
                            
                            if (matchedPairs === 4) {
                                updateScore(200);
                                showModal('‡§¨‡§ß‡§æ‡§à!', '‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä ‡§ú‡•ã‡§°‡§º‡•á ‡§Æ‡§ø‡§≤‡§æ ‡§≤‡§ø‡§è!');
                            }
                        } else {
                            document.querySelector(`[data-index="${flippedTiles[0].index}"]`).classList.remove('flipped');
                            document.querySelector(`[data-index="${flippedTiles[1].index}"]`).classList.remove('flipped');
                            document.querySelector(`[data-index="${flippedTiles[0].index}"]`).textContent = '?';
                            document.querySelector(`[data-index="${flippedTiles[1].index}"]`).textContent = '?';
                        }
                        flippedTiles = [];
                    }, 1000);
                }
            };
        }

        // Drag and Drop Game for Karma States
        function startDragDropGame() {
            const content = document.getElementById('lessonContent');
            const shuffledStates = [...karmaData.states].sort(() => Math.random() - 0.5);
            
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ ‡§ï‡•ç‡§∞‡§Æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ</h2>
                    <p>‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (‡§¨‡§Ç‡§ß ‡§∏‡•á ‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§ ‡§§‡§ï)</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h3>‡§Ö‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç:</h3>
                            <div id="sourceContainer">
                                ${shuffledStates.map((state, index) => `
                                    <div class="drag-item" draggable="true" data-state="${state.name}" id="item-${index}">
                                        ${state.name} - ${state.description}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3>‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç:</h3>
                            <div class="drop-zone" id="dropZone">
                                ‡§Ø‡§π‡§æ‡§Å ‡§ñ‡•Ä‡§Ç‡§ö‡§ï‡§∞ ‡§õ‡•ã‡§°‡§º‡•á‡§Ç
                            </div>
                            <button class="action-btn" onclick="checkOrder()" style="margin-top: 1rem;">‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç</button>
                        </div>
                    </div>
                </div>
            `;
            
            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const dragItems = document.querySelectorAll('.drag-item');
            const dropZone = document.getElementById('dropZone');
            
            dragItems.forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.target.classList.add('dragging');
                });
                
                item.addEventListener('dragend', function(e) {
                    e.target.classList.remove('dragging');
                });
            });
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const id = e.dataTransfer.getData('text/plain');
                const draggableElement = document.getElementById(id);
                
                if (this.textContent === '‡§Ø‡§π‡§æ‡§Å ‡§ñ‡•Ä‡§Ç‡§ö‡§ï‡§∞ ‡§õ‡•ã‡§°‡§º‡•á‡§Ç') {
                    this.textContent = '';
                }
                
                this.appendChild(draggableElement);
            });
        }

        window.checkOrder = function() {
            const dropZone = document.getElementById('dropZone');
            const items = dropZone.querySelectorAll('.drag-item');
            const correctOrder = ['‡§¨‡§Ç‡§ß', '‡§∏‡§§‡•ç‡§§‡•ç‡§µ', '‡§â‡§¶‡§Ø', '‡§â‡§¶‡•Ä‡§∞‡§£‡§æ', '‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£', '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£', '‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£', '‡§â‡§™‡§∂‡§Æ', '‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø', '‡§®‡§ø‡§ï‡§æ‡§ö‡§ø‡§§'];
            
            let isCorrect = true;
            items.forEach((item, index) => {
                if (item.dataset.state !== correctOrder[index]) {
                    isCorrect = false;
                }
            });
            
            if (isCorrect && items.length === 10) {
                updateScore(300);
                showModal('‡§∂‡§æ‡§¨‡§æ‡§∂!', '‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡§æ!');
            } else {
                showModal('‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç', '‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§π‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§Ø‡§æ ‡§ï‡•Å‡§õ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç ‡§õ‡•Ç‡§ü ‡§ó‡§à ‡§π‡•à‡§Ç‡•§');
            }
        };

        // Vigraha Gati Game
        function startVigrahGatiGame() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">‡§µ‡§ø‡§ó‡•ç‡§∞‡§π ‡§ó‡§§‡§ø ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü‡§∞</h2>
                    <p>‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•Ä ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡•á‡§Ç</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin: 2rem 0;">
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 2px solid var(--primary);">
                            <h3>‡§à‡§∑‡•Å ‡§ó‡§§‡§ø (‡•ß ‡§∏‡§Æ‡§Ø)</h3>
                            <div style="font-size: 3rem; text-align: center; margin: 1rem 0;">
                                ‚Üí
                            </div>
                            <p>‡§∏‡•Ä‡§ß‡•Ä ‡§∞‡•á‡§ñ‡§æ ‡§Æ‡•á‡§Ç ‡§ó‡§§‡§ø, ‡§ï‡•ã‡§à ‡§Æ‡•ã‡§°‡§º ‡§®‡§π‡•Ä‡§Ç</p>
                            <button class="action-btn" onclick="animateGati('ishu')">‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 2px solid var(--primary);">
                            <h3>‡§™‡§æ‡§£‡§ø‡§Æ‡•Å‡§ï‡•ç‡§§‡§æ ‡§ó‡§§‡§ø (‡•® ‡§∏‡§Æ‡§Ø)</h3>
                            <div style="font-size: 3rem; text-align: center; margin: 1rem 0;">
                                ‚ÜóÔ∏è
                            </div>
                            <p>‡§è‡§ï ‡§Æ‡•ã‡§°‡§º ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§§‡§ø</p>
                            <button class="action-btn" onclick="animateGati('pani')">‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 2px solid var(--primary);">
                            <h3>‡§≤‡§æ‡§Ç‡§ó‡§≤‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø (‡•© ‡§∏‡§Æ‡§Ø)</h3>
                            <div style="font-size: 3rem; text-align: center; margin: 1rem 0;">
                                ‚ÜóÔ∏è‚Üí
                            </div>
                            <p>‡§¶‡•ã ‡§Æ‡•ã‡§°‡§º ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§§‡§ø</p>
                            <button class="action-btn" onclick="animateGati('langal')">‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                        </div>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 2px solid var(--primary);">
                            <h3>‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø (‡•™ ‡§∏‡§Æ‡§Ø)</h3>
                            <div style="font-size: 3rem; text-align: center; margin: 1rem 0;">
                                „Ä∞Ô∏è
                            </div>
                            <p>‡§§‡•Ä‡§® ‡§Æ‡•ã‡§°‡§º ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§§‡§ø</p>
                            <button class="action-btn" onclick="animateGati('gomutra')">‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                        </div>
                    </div>
                    
                    <div id="gatiAnimation" style="height: 200px; background: var(--light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <p>‡§è‡§®‡§ø‡§Æ‡•á‡§∂‡§® ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞ ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                    </div>
                </div>
            `;
        }

        window.animateGati = function(type) {
            const animation = document.getElementById('gatiAnimation');
            let html = '';
            
            switch(type) {
                case 'ishu':
                    html = '<div style="animation: moveRight 1s;">üîµ ‚Üí ‚Üí ‚Üí ‚Üí üéØ</div>';
                    break;
                case 'pani':
                    html = '<div style="animation: moveUpRight 2s;">üîµ ‚ÜóÔ∏è ‚Üí üéØ</div>';
                    break;
                case 'langal':
                    html = '<div style="animation: moveLangal 3s;">üîµ ‚ÜóÔ∏è ‚Üí ‚ÜòÔ∏è üéØ</div>';
                    break;
                case 'gomutra':
                    html = '<div style="animation: moveWave 4s;">üîµ „Ä∞Ô∏è „Ä∞Ô∏è „Ä∞Ô∏è üéØ</div>';
                    break;
            }
            
            animation.innerHTML = html;
            updateScore(25);
        };

        // Timed Challenge
        function startTimedChallenge() {
            let timeLeft = 60;
            let questionsAnswered = 0;
            let correctAnswers = 0;
            let timerInterval;
            
            const questions = [
                {q: '‡§ò‡§æ‡§§‡§ø‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§ø‡§§‡§®‡•á ‡§π‡•à‡§Ç?', a: '‡•™'},
                {q: '‡§Ö‡§ò‡§æ‡§§‡§ø‡§Ø‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§ø‡§§‡§®‡•á ‡§π‡•à‡§Ç?', a: '‡•™'},
                {q: '‡§ï‡•Å‡§≤ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§ø‡§§‡§®‡•á ‡§π‡•à‡§Ç?', a: '‡•Æ'},
                {q: '‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑ ‡§ï‡§æ‡§≤ ‡§ï‡§ø‡§§‡§®‡•á ‡§π‡•à‡§Ç?', a: '‡•Æ'},
                {q: '‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç ‡§ï‡§ø‡§§‡§®‡•Ä ‡§π‡•à‡§Ç?', a: '‡•ß‡•¶'},
                {q: '‡§µ‡§ø‡§ó‡•ç‡§∞‡§π ‡§ó‡§§‡§ø ‡§ï‡§ø‡§§‡§®‡•Ä ‡§π‡•à‡§Ç?', a: '‡•™'}
            ];
            
            const content = document.getElementById('lessonContent');
            
            function endChallenge() {
                clearInterval(timerInterval);
                showModal('‡§∏‡§Æ‡§Ø ‡§ö‡•Å‡§®‡•å‡§§‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£!', `‡§Ü‡§™‡§®‡•á ${correctAnswers}/${questionsAnswered} ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡§ø‡§è!`);
                updateScore(correctAnswers * 50);
                setTimeout(() => {
                    closeModal();
                    startMasterChallenge();
                }, 3000);
            }
            
            function showNextQuestion() {
                if (timeLeft <= 0 || questionsAnswered >= questions.length) {
                    endChallenge();
                    return;
                }
                
                const q = questions[questionsAnswered];
                content.innerHTML = `
                    <div class="quiz-container">
                        <h2>‡§∏‡§Æ‡§Ø ‡§ö‡•Å‡§®‡•å‡§§‡•Ä - <span id="timer">${timeLeft}</span> ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§ï‡•Ä</h2>
                        <div class="question">${q.q}</div>
                        <input type="text" id="timedAnswer" style="padding: 0.5rem; font-size: 1.2rem; width: 200px; border: 2px solid var(--primary); border-radius: 4px;">
                        <button class="action-btn" onclick="checkTimedAnswer('${q.a}')">‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç</button>
                    </div>
                `;
                
                // Focus on input
                setTimeout(() => {
                    const input = document.getElementById('timedAnswer');
                    if (input) input.focus();
                }, 100);
            }
            
            window.checkTimedAnswer = function(correct) {
                const answer = document.getElementById('timedAnswer').value.trim();
                if (answer === correct) correctAnswers++;
                questionsAnswered++;
                showNextQuestion();
            };
            
            // Start timer
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('timer');
                if (timerEl) timerEl.textContent = timeLeft;
                if (timeLeft <= 0) {
                    endChallenge();
                }
            }, 1000);
            
            showNextQuestion();
        }

        // Scenario Analysis
        function startScenarioAnalysis() {
            const scenarios = [
                {
                    title: '‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä ‡§ï‡§æ ‡§Æ‡§æ‡§Æ‡§≤‡§æ',
                    description: '‡§è‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä ‡§®‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•ã ‡§ß‡•ã‡§ñ‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§î‡§∞ ‡§Æ‡•Å‡§®‡§æ‡§´‡§æ ‡§ï‡§Æ‡§æ‡§Ø‡§æ‡•§ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§â‡§∏‡•á ‡§™‡§õ‡§§‡§æ‡§µ‡§æ ‡§π‡•Å‡§Ü ‡§î‡§∞ ‡§â‡§∏‡§®‡•á ‡§¶‡§æ‡§® ‡§¶‡§ø‡§Ø‡§æ‡•§',
                    question: '‡§ï‡•å‡§® ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß‡•á ‡§î‡§∞ ‡§ï‡•å‡§® ‡§∏‡•á ‡§ï‡§Æ ‡§π‡•Å‡§è?',
                    answer: '‡§ß‡•ã‡§ñ‡•á ‡§∏‡•á ‡§®‡§æ‡§Æ ‡§ï‡§∞‡•ç‡§Æ (‡§Ö‡§∂‡•Å‡§≠) ‡§î‡§∞ ‡§ó‡•ã‡§§‡•ç‡§∞ ‡§ï‡§∞‡•ç‡§Æ (‡§®‡•Ä‡§ö) ‡§¨‡§Ç‡§ß‡•á‡•§ ‡§™‡§∂‡•ç‡§ö‡§æ‡§§‡§æ‡§™ ‡§∏‡•á ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£ ‡§î‡§∞ ‡§¶‡§æ‡§® ‡§∏‡•á ‡§™‡•Å‡§£‡•ç‡§Ø ‡§¨‡§Ç‡§ß‡§æ‡•§'
                },
                {
                    title: '‡§∏‡§æ‡§ß‡§ï ‡§ï‡•Ä ‡§∏‡§æ‡§ß‡§®‡§æ',
                    description: '‡§è‡§ï ‡§∏‡§æ‡§ß‡§ï ‡§®‡•á ‡•ß‡•® ‡§µ‡§∞‡•ç‡§∑ ‡§§‡§™ ‡§ï‡§ø‡§Ø‡§æ ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ö‡§Ç‡§§ ‡§Æ‡•á‡§Ç ‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞ ‡§Ü ‡§ó‡§Ø‡§æ‡•§',
                    question: '‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§¨‡§Ç‡§ß ‡§π‡•Å‡§Ü?',
                    answer: '‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞ ‡§∏‡•á ‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§®‡•Ä‡§ö ‡§ó‡•ã‡§§‡•ç‡§∞ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§¨‡§Ç‡§ß ‡§π‡•Å‡§Ü‡•§'
                }
            ];
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">üîç ‡§™‡§∞‡§ø‡§¶‡•É‡§∂‡•ç‡§Ø ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h2>
                    ${scenarios.map((s, i) => `
                        <div class="case-study-card">
                            <h3>${s.title}</h3>
                            <p>${s.description}</p>
                            <p><strong>‡§™‡•ç‡§∞‡§∂‡•ç‡§®:</strong> ${s.question}</p>
                            <button class="action-btn" onclick="showScenarioAnswer(${i})">‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                            <div id="scenario-answer-${i}" style="display: none; margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                                <strong>‡§â‡§§‡•ç‡§§‡§∞:</strong> ${s.answer}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        window.showScenarioAnswer = function(index) {
            document.getElementById(`scenario-answer-${index}`).style.display = 'block';
            updateScore(50);
        };

        // Karma Match Challenge
        function startKarmaMatchChallenge() {
            const content = document.getElementById('lessonContent');
            const matches = [
                {karma: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', analogy: '‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§∏‡•á ‡§¢‡§ï‡§æ ‡§Æ‡•Å‡§ñ'},
                {karma: '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£', analogy: '‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤'},
                {karma: '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø', analogy: '‡§∂‡§π‡§¶ ‡§≤‡§ø‡§™‡§ü‡•Ä ‡§§‡§≤‡§µ‡§æ‡§∞'},
                {karma: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', analogy: '‡§Æ‡§¶‡§ø‡§∞‡§æ'},
                {karma: '‡§Ü‡§Ø‡•Å', analogy: '‡§¨‡•á‡§°‡§º‡•Ä'},
                {karma: '‡§®‡§æ‡§Æ', analogy: '‡§ö‡§ø‡§§‡•ç‡§∞‡§ï‡§æ‡§∞'},
                {karma: '‡§ó‡•ã‡§§‡•ç‡§∞', analogy: '‡§ï‡•Å‡§Æ‡•ç‡§≠‡§ï‡§æ‡§∞'},
                {karma: '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø', analogy: '‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡•Ä'}
            ];
            
            const shuffledAnalogies = matches.map(m => m.analogy).sort(() => Math.random() - 0.5);
            
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary);">‡§ï‡§∞‡•ç‡§Æ ‡§â‡§™‡§Æ‡§æ ‡§Æ‡§ø‡§≤‡§æ‡§®</h2>
                    <p>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§â‡§∏‡§ï‡•Ä ‡§∏‡§π‡•Ä ‡§â‡§™‡§Æ‡§æ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡§æ‡§è‡§Ç</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                        <div>
                            <h3>‡§ï‡§∞‡•ç‡§Æ</h3>
                            ${matches.map((m, i) => `
                                <div style="padding: 0.5rem; margin: 0.5rem 0; background: var(--light); border-radius: 4px;">
                                    ${m.karma}
                                    <select id="match-${i}" style="margin-left: 1rem;">
                                        <option value="">‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                        ${shuffledAnalogies.map(a => `<option value="${a}">${a}</option>`).join('')}
                                    </select>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="checkMatches()">‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç</button>
                </div>
            `;
        }

        window.checkMatches = function() {
            const matches = [
                {karma: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', analogy: '‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§∏‡•á ‡§¢‡§ï‡§æ ‡§Æ‡•Å‡§ñ'},
                {karma: '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£', analogy: '‡§¶‡•ç‡§µ‡§æ‡§∞‡§™‡§æ‡§≤'},
                {karma: '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø', analogy: '‡§∂‡§π‡§¶ ‡§≤‡§ø‡§™‡§ü‡•Ä ‡§§‡§≤‡§µ‡§æ‡§∞'},
                {karma: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', analogy: '‡§Æ‡§¶‡§ø‡§∞‡§æ'},
                {karma: '‡§Ü‡§Ø‡•Å', analogy: '‡§¨‡•á‡§°‡§º‡•Ä'},
                {karma: '‡§®‡§æ‡§Æ', analogy: '‡§ö‡§ø‡§§‡•ç‡§∞‡§ï‡§æ‡§∞'},
                {karma: '‡§ó‡•ã‡§§‡•ç‡§∞', analogy: '‡§ï‡•Å‡§Æ‡•ç‡§≠‡§ï‡§æ‡§∞'},
                {karma: '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø', analogy: '‡§≠‡§£‡•ç‡§°‡§æ‡§∞‡•Ä'}
            ];
            
            let correct = 0;
            matches.forEach((m, i) => {
                const selected = document.getElementById(`match-${i}`).value;
                if (selected === m.analogy) correct++;
            });
            
            if (correct === 8) {
                updateScore(400);
                showModal('‡§™‡§∞‡§ø‡§™‡•Ç‡§∞‡•ç‡§£!', '‡§∏‡§≠‡•Ä ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§∏‡§π‡•Ä ‡§π‡•à‡§Ç!');
            } else {
                showModal('‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç', `${correct}/8 ‡§∏‡§π‡•Ä ‡§Æ‡§ø‡§≤‡§æ‡§®`);
            }
        };

        // Karma Selection
        function selectKarma(karmaId) {
            const karma = karmaData.types.find(k => k.id === karmaId);
            const cards = document.querySelectorAll('.karma-card');
            
            cards.forEach(card => {
                if (card.dataset.karma === karmaId) {
                    card.classList.toggle('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            if (karma) {
                const causesHtml = Array.isArray(karma.causes) ? 
                    karma.causes.map(c => `<li>${c}</li>`).join('') :
                    Object.entries(karma.causes).map(([key, val]) => 
                        Array.isArray(val) ? 
                        `<li>${key}: ${val.join(', ')}</li>` :
                        `<li>${key}: ${val}</li>`
                    ).join('');

                showModal(karma.name, `
                    <div style="text-align: left;">
                        <p><strong>‡§ï‡§æ‡§∞‡•ç‡§Ø:</strong> ${karma.function}</p>
                        <p><strong>‡§â‡§™‡§Æ‡§æ:</strong> ${karma.analogy}</p>
                        <p><strong>‡§ï‡§•‡§®:</strong> "${karma.story}"</p>
                        <div style="margin-top: 1rem;">
                            <strong>‡§ï‡§æ‡§∞‡§£:</strong>
                            <ul style="margin-top: 0.5rem;">
                                ${causesHtml}
                            </ul>
                        </div>
                    </div>
                `);
                
                // Add to knowledge base
                if (!gameState.karmaKnowledge.types.includes(karmaId)) {
                    gameState.karmaKnowledge.types.push(karmaId);
                    updateScore(100);
                    updateStageProgress(1, 12.5); // 8 karmas = 100%
                    
                    if (gameState.karmaKnowledge.types.length === 8) {
                        showAchievement('‡§ï‡§∞‡•ç‡§Æ ‡§µ‡§ø‡§¶‡•ç‡§µ‡§æ‡§®', '‡§∏‡§≠‡•Ä ‡•Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§ï‡•Ä!');
                    }
                }
            }
        }
        // Update stage progress
        function updateStageProgress(stage, amount) {
            gameState.stageProgress[stage] = Math.min(100, gameState.stageProgress[stage] + amount);
            
            // Update progress bar immediately on main menu
            const progressBar = document.getElementById(`progress${stage}`);
            if (progressBar) {
                progressBar.style.width = `${gameState.stageProgress[stage]}%`;
            }
            
            saveProgress();
            checkMasterUnlock();
            
            // Show achievement when stage is completed
            if (gameState.stageProgress[stage] >= 100 && !gameState.completedLessons.includes(`stage${stage}`)) {
                gameState.completedLessons.push(`stage${stage}`);
                showAchievement(`‡§ö‡§∞‡§£ ${stage} ‡§™‡•Ç‡§∞‡•ç‡§£!`, `‡§Ü‡§™‡§®‡•á ‡§ö‡§∞‡§£ ${stage} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§ø‡§Ø‡§æ!`);
            }
        }

        // Show Quiz Helper
        function showQuiz(questions, title, isMaster = false) {
            let currentQuestion = 0;
            let score = 0;
            
            function showQuestion() {
                if (currentQuestion >= questions.length) {
                    const percentage = (score / questions.length) * 100;
                    showModal(`${title} ‡§™‡•Ç‡§∞‡•ç‡§£!`, `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${questions.length} (${percentage.toFixed(0)}%)`);
                    updateScore(score * (isMaster ? 150 : 100));
                    
                    if (!isMaster && gameState.currentStage) {
                        updateStageProgress(gameState.currentStage, percentage / 4);
                    } else if (isMaster) {
                        updateStageProgress(4, percentage);
                    }
                    
                    setTimeout(() => {
                        closeModal();
                        if (!isMaster && gameState.currentStage) {
                            window[`loadStage${gameState.currentStage}`]();
                        } else {
                            startMasterChallenge();
                        }
                    }, 3000);
                    
                    return;
                }
                
                const q = questions[currentQuestion];
                const content = document.getElementById('lessonContent');
                content.innerHTML = `
                    <div class="quiz-container">
                        <h2 style="color: var(--primary);">${title}</h2>
                        <div style="margin-bottom: 1rem;">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}/${questions.length}</div>
                        <div class="question">${q.question}</div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <div class="option" onclick="handleQuizAnswer(${i}, ${q.correct})" style="cursor: pointer;">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            window.handleQuizAnswer = function(selected, correct) {
                const options = document.querySelectorAll('.option');
                options[selected].classList.add(selected === correct ? 'correct' : 'incorrect');
                if (selected !== correct) {
                    options[correct].classList.add('correct');
                } else {
                    score++;
                }
                
                // Disable all options
                options.forEach(opt => opt.style.pointerEvents = 'none');
                
                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 1500);
            };
            
            showQuestion();
        }

        // Other existing functions remain the same...
        function startKarmaCatcher() {
            const content = document.getElementById('lessonContent');
            let score = 0;
            let lives = 3;
            let gameActive = true;
            
            const scenarios = [
                { text: '‡§à‡§∞‡•ç‡§∑‡•ç‡§Ø‡§æ ‡§∏‡•á ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§õ‡§ø‡§™‡§æ‡§®‡§æ', karma: 'jnanavarana' },
                { text: '‡§Ü‡§≤‡§∏‡•ç‡§Ø ‡§∏‡•á ‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•ã‡§®‡§æ', karma: 'darshanavarana' },
                { text: '‡§™‡•Ä‡§°‡§º‡§ø‡§§ ‡§ú‡§æ‡§®‡§µ‡§∞‡•ã‡§Ç ‡§™‡§∞ ‡§¶‡§Ø‡§æ', karma: 'vedaniya' },
                { text: '‡§µ‡•ç‡§∞‡§§ ‡§≤‡•á‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§®‡§æ', karma: 'mohaniya' },
                { text: '‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§≤‡§ó‡§æ‡§µ', karma: 'ayu' },
                { text: '‡§ï‡•Å‡§ü‡§ø‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø', karma: 'nama' },
                { text: '‡§Ü‡§§‡•ç‡§Æ ‡§™‡•ç‡§∞‡§∂‡§Ç‡§∏‡§æ', karma: 'gotra' },
                { text: '‡§¶‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§ß‡§æ', karma: 'antaraya' }
            ];
            
            const karmaTypes = [
                {id: 'jnanavarana', name: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', color: '#6B46C1'},
                {id: 'darshanavarana', name: '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£', color: '#9333EA'},
                {id: 'vedaniya', name: '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø', color: '#F59E0B'},
                {id: 'mohaniya', name: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', color: '#EF4444'}
            ];
            
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary);">‡§ï‡§∞‡•ç‡§Æ ‡§™‡§ï‡§°‡§º‡§®‡•á ‡§ï‡§æ ‡§ñ‡•á‡§≤</h2>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div>‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="catcherScore">0</span></div>
                        <div>‡§ú‡•Ä‡§µ‡§®: <span id="catcherLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
                    </div>
                    
                    <div style="position: relative; height: 400px; background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%); border-radius: 8px; overflow: hidden;" id="gameArea">
                        <!-- Falling scenarios will appear here -->
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-top: 1rem;">
                        ${karmaTypes.map(k => `
                            <div class="karma-basket" 
                                data-karma="${k.id}"
                                style="background: ${k.color}; color: white; padding: 1rem; border-radius: 8px; text-align: center; cursor: pointer; user-select: none;">
                                ${k.name}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            let activeScenario = null;
            let selectedBasket = null;
            
            // Basket selection
            document.querySelectorAll('.karma-basket').forEach(basket => {
                basket.addEventListener('click', function() {
                    if (!gameActive) return;
                    document.querySelectorAll('.karma-basket').forEach(b => b.style.border = 'none');
                    this.style.border = '3px solid white';
                    selectedBasket = this.dataset.karma;
                });
            });
            
            function dropScenario() {
                if (!gameActive) return;
                
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                const gameArea = document.getElementById('gameArea');
                
                const drop = document.createElement('div');
                drop.style.cssText = `
                    position: absolute;
                    left: ${Math.random() * 70 + 15}%;
                    top: -50px;
                    background: white;
                    padding: 0.5rem 1rem;
                    border-radius: 8px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                    transition: top 4s linear;
                    max-width: 200px;
                    font-size: 0.9rem;
                `;
                drop.textContent = scenario.text;
                drop.dataset.karma = scenario.karma;
                
                gameArea.appendChild(drop);
                
                // Start falling
                setTimeout(() => {
                    drop.style.top = '380px';
                }, 100);
                
                // Check if caught or missed
                setTimeout(() => {
                    if (drop.parentElement) {
                        // Missed
                        lives--;
                        updateLives();
                        drop.remove();
                        if (lives <= 0) {
                            endGame();
                        }
                    }
                }, 4100);
                
                // Click to catch
                drop.addEventListener('click', function() {
                    if (!gameActive) return;
                    if (selectedBasket === this.dataset.karma) {
                        score += 10;
                        document.getElementById('catcherScore').textContent = score;
                        this.style.background = '#10B981';
                        this.textContent = '‚úì';
                    } else {
                        lives--;
                        updateLives();
                        this.style.background = '#EF4444';
                        this.textContent = '‚úó';
                    }
                    setTimeout(() => this.remove(), 500);
                });
            }
            
            function updateLives() {
                const hearts = '‚ù§Ô∏è'.repeat(Math.max(0, lives));
                document.getElementById('catcherLives').textContent = hearts || 'üíî';
            }
            
            function endGame() {
                gameActive = false;
                showModal('‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!', `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}`);
                updateScore(score * 5);
                updateStageProgress(1, 25);
            }
            
            // Start dropping scenarios
            const dropInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(dropInterval);
                    return;
                }
                dropScenario();
            }, 2000);
            
            // Drop first scenario immediately
            dropScenario();
        }

        function showKarmaQuiz() {
            const questions = [
                {
                    question: '‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§§‡•Å‡§≤‡§®‡§æ ‡§Æ‡§¶‡§ø‡§∞‡§æ ‡§∏‡•á ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à?',
                    options: ['‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø', '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø'],
                    correct: 1
                },
                {
                    question: '‡§ï‡§ø‡§§‡§®‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ò‡§æ‡§§‡§ø‡§Ø‡§æ (‡§µ‡§ø‡§®‡§æ‡§∂‡§ï‡§æ‡§∞‡•Ä) ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§ó‡•Ä‡§ï‡•É‡§§ ‡§π‡•à‡§Ç?',
                    options: ['‡•®', '‡•™', '‡•¨', '‡•Æ'],
                    correct: 1
                },
                {
                    question: '‡§ï‡§ø‡§∏ ‡§ï‡§∞‡•ç‡§Æ ‡§®‡•á ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§≠‡§ó‡§µ‡§æ‡§® ‡§ï‡•ã ‡§Æ‡§π‡•Ä‡§®‡•ã‡§Ç ‡§§‡§ï ‡§≠‡•ã‡§ú‡§® ‡§∏‡•á ‡§µ‡§Ç‡§ö‡§ø‡§§ ‡§∞‡§ñ‡§æ?',
                    options: ['‡§Ü‡§Ø‡•Å', '‡§®‡§æ‡§Æ', '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø', '‡§µ‡•á‡§¶‡§®‡•Ä‡§Ø'],
                    correct: 2
                },
                {
                    question: '‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•ã‡§®‡•á ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß‡§§‡§æ ‡§π‡•à?',
                    options: ['‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£', '‡§¶‡§∞‡•ç‡§∂‡§®‡§æ‡§µ‡§∞‡§£', '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø', '‡§Ö‡§Ç‡§§‡§∞‡§æ‡§Ø'],
                    correct: 1
                }
            ];
            
            showQuiz(questions, '‡§ï‡§∞‡•ç‡§Æ ‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä');
        }

        function showKarmaStories() {
            const stories = [
                {
                    title: '‡§¨‡§æ‡§π‡•Å‡§¨‡§≤‡•Ä ‡§ï‡•Ä ‡§ñ‡§°‡§º‡•Ä ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡§æ‡§ß‡§®‡§æ',
                    karma: '‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                    story: '‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§¨‡§æ‡§π‡•Å‡§¨‡§≤‡•Ä ‡§è‡§ï ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡§∞‡•ç‡§∑ ‡§§‡§ï ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ñ‡§°‡§º‡•á ‡§∞‡§π‡•á‡•§ ‡§â‡§®‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§∏‡§æ‡§ß‡§®‡§æ ‡§ï‡•á ‡§¨‡§æ‡§µ‡§ú‡•Ç‡§¶, ‡§ú‡•ç‡§û‡§æ‡§®‡§æ‡§µ‡§∞‡§£ ‡§ï‡§∞‡•ç‡§Æ ‡§®‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§∏‡§∞‡•ç‡§µ‡§ú‡•ç‡§û‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§æ ‡§ú‡§¨ ‡§§‡§ï ‡§â‡§®‡•ç‡§π‡•ã‡§Ç‡§®‡•á ‡§Ö‡§™‡§®‡•á ‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ ‡§Ö‡§≠‡§ø‡§Æ‡§æ‡§® ‡§™‡§∞ ‡§µ‡§ø‡§ú‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§à‡•§'
                },
                {
                    title: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§ï‡§æ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®',
                    karma: '‡§Ü‡§Ø‡•Å',
                    story: '‡§∞‡§æ‡§ú‡§æ ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§ï ‡§®‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡•©‡•© ‡§∏‡§æ‡§ó‡§∞ ‡§ï‡•Ä ‡§®‡§æ‡§∞‡§ï‡•Ä‡§Ø ‡§Ü‡§Ø‡•Å ‡§¨‡§æ‡§Ç‡§ß‡•Ä ‡§•‡•Ä‡•§ ‡§≤‡•á‡§ï‡§ø‡§® ‡§∏‡§Æ‡•ç‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§ï‡•á ‡§â‡§®‡•ç‡§π‡•ã‡§Ç‡§®‡•á ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§á‡§∏‡•á ‡§ï‡•á‡§µ‡§≤ ‡•Æ‡•™,‡•¶‡•¶‡•¶ ‡§µ‡§∞‡•ç‡§∑ ‡§§‡§ï ‡§ï‡§Æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ‡•§'
                },
                {
                    title: '‡§≠‡§ó‡§µ‡§æ‡§® ‡§∞‡§æ‡§Æ ‡§ï‡§æ ‡§Æ‡•ã‡§π',
                    karma: '‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø',
                    story: '‡§Æ‡§π‡§æ‡§® ‡§≠‡§ó‡§µ‡§æ‡§® ‡§∞‡§æ‡§Æ ‡§≠‡•Ä ‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ ‡§∏‡•á ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§π‡•Å‡§è, ‡§Ö‡§™‡§®‡•á ‡§≠‡§æ‡§à ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡§£ ‡§ï‡•á ‡§Æ‡•É‡§§ ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•ã ‡•¨ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§§‡§ï ‡§≤‡•á ‡§ú‡§æ‡§§‡•á ‡§∞‡§π‡•á ‡§î‡§∞ ‡§µ‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•Ä‡§§‡§æ ‡§ï‡•Ä ‡§Ö‡§Ç‡§§‡§π‡•Ä‡§® ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡§§‡•á ‡§∞‡§π‡•á‡•§'
                }
            ];
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">üìö ‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞‡•ã‡§Ç ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§•‡§æ‡§è‡§Ç</h2>
                    ${stories.map(story => `
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; margin: 1rem 0; border-left: 4px solid var(--primary);">
                            <h3 style="color: var(--primary); margin-bottom: 0.5rem;">${story.title}</h3>
                            <p style="color: var(--accent); margin-bottom: 1rem;">‡§ï‡§∞‡•ç‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞: ${story.karma}</p>
                            <p style="line-height: 1.8;">${story.story}</p>
                        </div>
                    `).join('')}
                    <button class="action-btn" onclick="loadStage1()">‡§™‡§æ‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏</button>
                </div>
            `;
        }

        function startKarmaSimulator() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">‡§ï‡§∞‡•ç‡§Æ ‡§™‡•ç‡§∞‡§µ‡§æ‡§π ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§ü‡§∞</h2>
                    <p style="margin-bottom: 2rem;">
                        ‡§Ü‡§™‡§ï‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§£ ‡§ú‡•Å‡§°‡§º‡•á ‡§π‡•à‡§Ç‡•§ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§∞‡•Ç‡§™‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§°‡•ã‡§Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç!
                    </p>
                    
                    <div style="display: flex; justify-content: center; margin: 2rem 0;">
                        <div style="position: relative;">
                            <div class="soul-avatar" style="width: 150px; height: 150px;">
                                <div id="karmaParticles" style="position: absolute; width: 100%; height: 100%;">
                                    <!-- Karma particles will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="action-btn" onclick="applyKarmaAction('apakarsana')">
                            ‡§∏‡§ö‡•ç‡§ö‡§æ ‡§™‡§∂‡•ç‡§ö‡§æ‡§§‡§æ‡§™<br><small>(‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑‡§£)</small>
                        </button>
                        <button class="action-btn" onclick="applyKarmaAction('utkarsana')">
                            ‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§ï‡•ç‡§∞‡•ã‡§ß<br><small>(‡§â‡§§‡•ç‡§ï‡§∞‡•ç‡§∑‡§£)</small>
                        </button>
                        <button class="action-btn" onclick="applyKarmaAction('sankramana')">
                            ‡§∏‡§Æ‡•ç‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ<br><small>(‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£)</small>
                        </button>
                        <button class="action-btn" onclick="applyKarmaAction('upasama')">
                            ‡§ó‡§π‡§® ‡§ß‡•ç‡§Ø‡§æ‡§®<br><small>(‡§â‡§™‡§∂‡§Æ)</small>
                        </button>
                        <button class="action-btn" onclick="applyKarmaAction('udirana')">
                            ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏<br><small>(‡§â‡§¶‡•Ä‡§∞‡§£‡§æ)</small>
                        </button>
                        <button class="action-btn" onclick="applyKarmaAction('jina-darshan')">
                            ‡§ú‡§ø‡§® ‡§¶‡§∞‡•ç‡§∂‡§®<br><small>(‡§§‡§æ‡§≤‡•á ‡§§‡•ã‡§°‡§º‡•á‡§Ç)</small>
                        </button>
                    </div>
                    
                    <div id="simulatorStatus" style="margin-top: 2rem; padding: 1rem; background: white; border-radius: 8px;">
                        ‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§£ ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø
                    </div>
                </div>
            `;
            
            // Initialize karma particles
            initializeKarmaParticles();
        }

        function initializeKarmaParticles() {
            const container = document.getElementById('karmaParticles');
            const particles = [
                { type: 'jnanavarana', color: '#6B46C1', size: 30, locked: false },
                { type: 'mohaniya', color: '#EF4444', size: 40, locked: false },
                { type: 'vedaniya', color: '#F59E0B', size: 25, locked: false },
                { type: 'antaraya', color: '#DC2626', size: 20, locked: true }
            ];
            
            container.innerHTML = particles.map((p, i) => `
                <div class="karma-particle" 
                     data-type="${p.type}" 
                     data-locked="${p.locked}"
                     style="
                        position: absolute;
                        width: ${p.size}px;
                        height: ${p.size}px;
                        background: ${p.color};
                        border-radius: 50%;
                        opacity: 0.7;
                        top: ${20 + i * 25}%;
                        left: ${20 + i * 20}%;
                        transition: all 0.5s;
                        ${p.locked ? 'border: 3px solid #000;' : ''}
                     ">
                    ${p.locked ? 'üîí' : ''}
                </div>
            `).join('');
        }

        function applyKarmaAction(action) {
            const particles = document.querySelectorAll('.karma-particle');
            const status = document.getElementById('simulatorStatus');
            
            switch(action) {
                case 'apakarsana':
                    particles.forEach(p => {
                        if (p.dataset.locked !== 'true') {
                            const currentSize = parseInt(p.style.width);
                            p.style.width = p.style.height = `${currentSize * 0.8}px`;
                        }
                    });
                    status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§™‡§∂‡•ç‡§ö‡§æ‡§§‡§æ‡§™ ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§ï‡§Æ ‡§π‡•Å‡§à';
                    break;
                    
                case 'utkarsana':
                    particles.forEach(p => {
                        if (p.dataset.type === 'mohaniya' && p.dataset.locked !== 'true') {
                            const currentSize = parseInt(p.style.width);
                            p.style.width = p.style.height = `${currentSize * 1.3}px`;
                            p.style.background = '#8B0000';
                        }
                    });
                    status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§ï‡•ç‡§∞‡•ã‡§ß ‡§®‡•á ‡§Æ‡•ã‡§π‡§®‡•Ä‡§Ø ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§ï‡§ø‡§Ø‡§æ!';
                    break;
                    
                case 'sankramana':
                    particles.forEach(p => {
                        if (p.dataset.type === 'vedaniya' && p.dataset.locked !== 'true') {
                            p.style.background = '#10B981';
                        }
                    });
                    status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§Ö‡§∏‡§æ‡§§‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§∏‡§æ‡§§‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§Æ‡•á‡§Ç ‡§∞‡•Ç‡§™‡§æ‡§Ç‡§§‡§∞‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ';
                    break;
                    
                case 'upasama':
                    particles.forEach(p => {
                        if (p.dataset.locked !== 'true') {
                            p.style.opacity = '0.2';
                        }
                    });
                    status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¶‡§¨‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ';
                    setTimeout(() => {
                        particles.forEach(p => p.style.opacity = '0.7');
                    }, 3000);
                    break;
                    
                case 'udirana':
                    particles[0].style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        particles[0].style.display = 'none';
                        status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§´‡§≤ ‡§¶‡•á‡§ï‡§∞ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ';
                    }, 500);
                    break;
                    
                case 'jina-darshan':
                    particles.forEach(p => {
                        if (p.dataset.locked === 'true') {
                            p.dataset.locked = 'false';
                            p.innerHTML = '';
                            p.style.border = 'none';
                        }
                    });
                    status.textContent = '‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§™‡§µ‡§ø‡§§‡•ç‡§∞ ‡§¶‡§∞‡•ç‡§∂‡§® ‡§®‡•á ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•ç‡§Æ‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§≤‡§æ!';
                    showAchievement('‡§§‡§æ‡§≤‡§æ ‡§§‡•ã‡§°‡§º‡§®‡•á ‡§µ‡§æ‡§≤‡§æ', '‡§Ü‡§™‡§®‡•á ‡§®‡§ø‡§ß‡§§‡•ç‡§§‡§ø ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§ñ‡•ã‡§≤‡§æ!');
                    break;
            }
            
            updateScore(50);
            updateStageProgress(2, 5);
        }

        function startLifespanCalculator() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary);">‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§ó‡§£‡§ï</h2>
                    <p>‡§ï‡•Å‡§≤ ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§¨ ‡§¨‡§Ç‡§ß ‡§∏‡§ï‡§§‡§æ ‡§π‡•à</p>
                    
                    <div style="margin: 2rem 0;">
                        <label style="display: block; margin-bottom: 0.5rem;">‡§ï‡•Å‡§≤ ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ (‡§µ‡§∞‡•ç‡§∑) ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:</label>
                        <input type="number" id="lifespanInput" value="729" style="padding: 0.5rem; font-size: 1.1rem; border: 2px solid var(--primary); border-radius: 4px;">
                        <button class="action-btn" onclick="calculateApakarsa()" style="margin-left: 1rem;">‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                    
                    <div id="apakarsaResults" style="background: white; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                        <!-- Results will appear here -->
                    </div>
                </div>
            `;
        }

        function calculateApakarsa() {
            const lifespan = parseInt(document.getElementById('lifespanInput').value);
            const results = document.getElementById('apakarsaResults');
            
            const periods = [];
            let remaining = lifespan;
            
            for (let i = 1; i <= 8; i++) {
                const bindPoint = remaining * (2/3);
                periods.push({
                    period: i,
                    atAge: lifespan - remaining + bindPoint,
                    remaining: remaining - bindPoint
                });
                remaining = remaining / 3;
            }
            
            results.innerHTML = `
                <h3 style="color: var(--primary); margin-bottom: 1rem;">${lifespan} ‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡•Æ ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑ ‡§ï‡§æ‡§≤</h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--light);">
                            <th style="padding: 0.5rem; text-align: left;">‡§ï‡§æ‡§≤</th>
                            <th style="padding: 0.5rem; text-align: left;">‡§¨‡§Ç‡§ß‡§® ‡§Ü‡§Ø‡•Å</th>
                            <th style="padding: 0.5rem; text-align: left;">‡§∂‡•á‡§∑ ‡§µ‡§∞‡•ç‡§∑</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${periods.map(p => `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 0.5rem;">${p.period}</td>
                                <td style="padding: 0.5rem;">${p.atAge.toFixed(2)} ‡§µ‡§∞‡•ç‡§∑</td>
                                <td style="padding: 0.5rem;">${p.remaining.toFixed(2)} ‡§µ‡§∞‡•ç‡§∑</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <p style="margin-top: 1rem; font-style: italic;">
                    ‡§Ø‡§¶‡§ø ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ï‡§æ‡§≤ ‡§Æ‡•á‡§Ç ‡§¨‡§Ç‡§ß‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ø‡§π ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§§‡§¨ ‡§π‡•ã‡§§‡§æ ‡§π‡•à 
                    ‡§ú‡§¨ ‡§ú‡•Ä‡§µ‡§®‡§ï‡§æ‡§≤ ‡§ï‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§Ö‡§§‡§ø‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ ‡§Ö‡§Ç‡§∂ ‡§∂‡•á‡§∑ ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§
                </p>
            `;
            
            updateScore(50);
            updateStageProgress(3, 10);
        }

        function showDeathTransition() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">üåü ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ</h2>
                    
                    <div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                        <h3 style="color: var(--primary);">‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§∏‡§Æ‡§Ø</h3>
                        <p>‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡•© ‡§∏‡§Æ‡§Ø (‡§∏‡§Æ‡§Ø)‡•§ ‡§ö‡•å‡§•‡•á ‡§Æ‡•á‡§Ç, ‡§®‡§Ø‡§æ ‡§∂‡§∞‡•Ä‡§∞ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§</p>
                    </div>
                    
                    <div style="margin: 2rem 0;">
                        <h3 style="color: var(--primary); margin-bottom: 1rem;">‡•™ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§ó‡§§‡§ø (‡§µ‡§ø‡§ó‡•ç‡§∞‡§π ‡§ó‡§§‡§ø)</h3>
                        
                        <div style="display: grid; gap: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 1rem;">
                                <div style="font-size: 2rem;">‚û°Ô∏è</div>
                                <div>
                                    <strong>‡§à‡§∑‡•Å ‡§ó‡§§‡§ø</strong> - ‡§§‡•Ä‡§∞ ‡§ï‡•Ä ‡§§‡§∞‡§π (‡•ß ‡§∏‡§Æ‡§Ø)<br>
                                    <small>‡§∏‡•Ä‡§ß‡§æ ‡§Æ‡§æ‡§∞‡•ç‡§ó, ‡§ï‡•ã‡§à ‡§Æ‡•ã‡§°‡§º ‡§®‡§π‡•Ä‡§Ç</small>
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 1rem;">
                                <div style="font-size: 2rem;">‚ÜóÔ∏è</div>
                                <div>
                                    <strong>‡§™‡§æ‡§£‡§ø‡§Æ‡•Å‡§ï‡•ç‡§§‡§æ ‡§ó‡§§‡§ø</strong> - ‡§´‡•á‡§Ç‡§ï‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•Ä ‡§§‡§∞‡§π (‡•® ‡§∏‡§Æ‡§Ø)<br>
                                    <small>‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§Æ‡•ã‡§°‡§º</small>
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 1rem;">
                                <div style="font-size: 2rem;">‚ÜóÔ∏è‚û°Ô∏è</div>
                                <div>
                                    <strong>‡§≤‡§æ‡§Ç‡§ó‡§≤‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø</strong> - ‡§π‡§≤ ‡§ï‡•Ä ‡§§‡§∞‡§π (‡•© ‡§∏‡§Æ‡§Ø)<br>
                                    <small>‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§Æ‡•á‡§Ç ‡§¶‡•ã ‡§Æ‡•ã‡§°‡§º</small>
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 1rem;">
                                <div style="font-size: 2rem;">„Ä∞Ô∏è</div>
                                <div>
                                    <strong>‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø</strong> - ‡§ó‡§æ‡§Ø ‡§ï‡•á ‡§Æ‡•Ç‡§§‡•ç‡§∞ ‡§ß‡§æ‡§∞‡§æ ‡§ï‡•Ä ‡§§‡§∞‡§π (‡•™ ‡§∏‡§Æ‡§Ø)<br>
                                    <small>‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§Æ‡•á‡§Ç ‡§§‡•Ä‡§® ‡§Æ‡•ã‡§°‡§º</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="loadStage3()">‡§Ü‡§Ø‡•Å ‡§™‡§æ‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏</button>
                </div>
            `;
        }

        function ayuQuiz() {
            const questions = [
                {
                    question: '‡§ï‡§ø‡§§‡§®‡•á ‡§Ö‡§™‡§ï‡§∞‡•ç‡§∑ ‡§ï‡§æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß ‡§∏‡§ï‡§§‡§æ ‡§π‡•à?',
                    options: ['‡•™', '‡•¨', '‡•Æ', '‡•ß‡•¶'],
                    correct: 2
                },
                {
                    question: '‡§ï‡§ø‡§® ‡§ú‡•Ä‡§µ‡•ã‡§Ç ‡§ï‡§æ ‡§Ö‡§ï‡§æ‡§≤ ‡§Æ‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ?',
                    options: ['‡§ï‡•á‡§µ‡§≤ ‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø', '‡§ï‡•á‡§µ‡§≤ ‡§ú‡§æ‡§®‡§µ‡§∞', '‡§¶‡•á‡§µ ‡§î‡§∞ ‡§®‡§æ‡§∞‡§ï‡•Ä ‡§ú‡•Ä‡§µ', '‡§∏‡§≠‡•Ä ‡§ú‡•Ä‡§µ'],
                    correct: 2
                },
                {
                    question: '‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§∏‡§Æ‡§Ø?',
                    options: ['‡•ß ‡§∏‡§Æ‡§Ø', '‡•© ‡§∏‡§Æ‡§Ø', '‡•™ ‡§∏‡§Æ‡§Ø', '‡•≠ ‡§∏‡§Æ‡§Ø'],
                    correct: 1
                },
                {
                    question: '‡§ï‡•å‡§® ‡§∏‡•Ä ‡§ó‡§§‡§ø ‡•™ ‡§∏‡§Æ‡§Ø ‡§≤‡•á‡§§‡•Ä ‡§π‡•à?',
                    options: ['‡§à‡§∑‡•Å ‡§ó‡§§‡§ø', '‡§™‡§æ‡§£‡§ø‡§Æ‡•Å‡§ï‡•ç‡§§‡§æ ‡§ó‡§§‡§ø', '‡§≤‡§æ‡§Ç‡§ó‡§≤‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø', '‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§ó‡§§‡§ø'],
                    correct: 3
                }
            ];
            
            showQuiz(questions, '‡§Ü‡§Ø‡•Å ‡§ï‡§∞‡•ç‡§Æ ‡§ö‡•Å‡§®‡•å‡§§‡•Ä');
        }

        // Utility Functions
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function backToMenu() {
            document.getElementById('gameContainer').classList.remove('active');
            document.getElementById('mainMenu').classList.add('active');
            
            // Update all progress bars when returning to menu
            Object.keys(gameState.stageProgress).forEach(stage => {
                const progressBar = document.getElementById(`progress${stage}`);
                if (progressBar) {
                    progressBar.style.width = `${gameState.stageProgress[stage]}%`;
                }
            });
            
            // Check and update master unlock status
            checkMasterUnlock();
            saveProgress();
        }

        function updateScore(points) {
            gameState.score += points;
            document.getElementById('scoreValue').textContent = gameState.score;
            
            // Level up every 1000 points
            const newLevel = Math.floor(gameState.score / 1000) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                document.getElementById('levelValue').textContent = gameState.level;
                showAchievement('‡§∏‡•ç‡§§‡§∞ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø!', `‡§Ü‡§™‡§®‡•á ‡§∏‡•ç‡§§‡§∞ ${gameState.level} ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ`);
            }
            
            saveProgress();
        }

        function showAchievement(title, desc) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = desc;
            
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
            
            if (!gameState.unlockedAchievements.includes(title)) {
                gameState.unlockedAchievements.push(title);
                updateScore(200);
            }
        }

        function saveProgress() {
            localStorage.setItem('karmaGameState', JSON.stringify(gameState));
        }

        function loadProgress() {
            const saved = localStorage.getItem('karmaGameState');
            if (saved) {
                gameState = JSON.parse(saved);
                document.getElementById('scoreValue').textContent = gameState.score;
                document.getElementById('levelValue').textContent = gameState.level;
                
                // Update progress bars
                Object.keys(gameState.stageProgress).forEach(stage => {
                    const progressBar = document.getElementById(`progress${stage}`);
                    if (progressBar) {
                        progressBar.style.width = `${gameState.stageProgress[stage]}%`;
                    }
                });
            }
        }
    </script>

    <style>
        @keyframes moveRight {
            from { transform: translateX(0); }
            to { transform: translateX(100px); }
        }
        
        @keyframes moveUpRight {
            0% { transform: translate(0, 0); }
            50% { transform: translate(50px, -50px); }
            100% { transform: translate(100px, -50px); }
        }
        
        @keyframes moveLangal {
            0% { transform: translate(0, 0); }
            33% { transform: translate(30px, -30px); }
            66% { transform: translate(60px, -30px); }
            100% { transform: translate(90px, 0); }
        }
        
        @keyframes moveWave {
            0% { transform: translate(0, 0); }
            25% { transform: translate(25px, -20px); }
            50% { transform: translate(50px, 0); }
            75% { transform: translate(75px, -20px); }
            100% { transform: translate(100px, 0); }
        }
    </style>
</body>
</html>
