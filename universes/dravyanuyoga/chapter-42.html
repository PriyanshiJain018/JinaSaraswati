<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§æ‡§®‡•Å‡§Ø‡•ã‡§ó ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§£‡•ç‡§° - ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #9370DB;
            --secondary: #8A2BE2;
            --accent: #FFD700;
            --anger: #DC143C;
            --pride: #4169E1;
            --deceit: #FF8C00;
            --greed: #228B22;
            --dark: #1F2937;
            --light: #F9FAFB;
            --success: #10B981;
            --danger: #EF4444;
            --gradient: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
        }

        body {
            font-family: 'Noto Sans Devanagari', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .soul-loader {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.3) 70%);
            box-shadow: 0 0 60px rgba(255,255,255,0.6);
            animation: pulse 2s infinite;
            position: relative;
        }

        .karma-dust {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(139, 69, 19, 0.8);
            border-radius: 50%;
            animation: orbit 3s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes orbit {
            from { transform: rotate(0deg) translateX(80px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(80px) rotate(-360deg); }
        }

        /* Main Menu */
        .main-menu {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            background: var(--gradient);
        }

        .main-menu.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .menu-container {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }

        .game-title {
            font-size: 3rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            margin-bottom: 3rem;
        }

        .stage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stage-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stage-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent);
        }

        .stage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .stage-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stage-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stage-description {
            color: var(--dark);
            opacity: 0.8;
        }

        /* Game Container */
        .game-container {
            display: none;
            min-height: 100vh;
            background: var(--light);
        }

        .game-container.active {
            display: block;
        }

        /* Header */
        .game-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        .back-btn:hover {
            background: var(--secondary);
            transform: scale(1.05);
        }

        .score-display {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
        }

        /* Lesson Content */
        .lesson-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .lesson-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Soul Visualization */
        .soul-container {
            display: flex;
            justify-content: center;
            margin: 3rem 0;
            position: relative;
        }

        .soul-avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 50%, #FF6347 100%);
            position: relative;
            animation: glow 3s ease-in-out infinite;
            box-shadow: 0 0 60px rgba(255,215,0,0.6);
            transition: all 0.5s;
        }

        .soul-avatar.dimmed {
            background: radial-gradient(circle, #8B7355 0%, #6B5B4E 50%, #4A3F36 100%);
            box-shadow: 0 0 30px rgba(139,115,85,0.4);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 60px rgba(255,215,0,0.6); }
            50% { box-shadow: 0 0 80px rgba(255,215,0,0.9); }
        }

        .karma-particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
            animation: attach 0.5s forwards;
        }

        @keyframes attach {
            from {
                transform: translate(0, -100px);
                opacity: 0;
            }
            to {
                transform: translate(0, 0);
                opacity: 0.8;
            }
        }

        /* Kashaya Cards */
        .kashaya-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .kashaya-card {
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            color: white;
        }

        .kashaya-card.anger { background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%); }
        .kashaya-card.pride { background: linear-gradient(135deg, #4169E1 0%, #1E3A8A 100%); }
        .kashaya-card.deceit { background: linear-gradient(135deg, #FF8C00 0%, #FF6347 100%); }
        .kashaya-card.greed { background: linear-gradient(135deg, #228B22 0%, #006400 100%); }

        .kashaya-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .kashaya-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .kashaya-icon {
            font-size: 2rem;
            float: right;
        }

        /* Intensity Meter */
        .intensity-meter {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .intensity-slider {
            width: 100%;
            margin: 2rem 0;
        }

        .intensity-levels {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .intensity-level {
            text-align: center;
            padding: 1rem;
            border-radius: 8px;
            background: var(--light);
            transition: all 0.3s;
        }

        .intensity-level.active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        /* No-Kashaya Wheel */
        .nokashaya-wheel {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 2rem auto;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
        }

        .petal {
            position: absolute;
            width: 120px;
            height: 60px;
            background: linear-gradient(135deg, rgba(147,112,219,0.8) 0%, rgba(138,43,226,0.8) 100%);
            border-radius: 60px 60px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            transform-origin: bottom center;
        }

        .petal:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, rgba(147,112,219,1) 0%, rgba(138,43,226,1) 100%);
        }

        /* Minigame Container */
        .minigame-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--accent);
            color: var(--dark);
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Quiz Section */
        .quiz-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .question {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--dark);
        }

        .options {
            display: grid;
            gap: 1rem;
        }

        .option {
            background: var(--light);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .option:hover {
            border-color: var(--primary);
            background: white;
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Scenario Card */
        .scenario-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid var(--accent);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            animation: slideIn 0.3s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 2rem;
            right: -400px;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: right 0.5s;
            z-index: 2000;
        }

        .achievement-popup.show {
            right: 2rem;
        }

        /* Analogy Display */
        .analogy-display {
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid var(--primary);
        }

        /* Timer Display */
        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--danger);
            text-align: center;
            margin: 1rem 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-title { font-size: 2rem; }
            .stage-grid { grid-template-columns: 1fr; }
            .kashaya-grid { grid-template-columns: 1fr; }
            .nokashaya-wheel { 
                width: 300px; 
                height: 300px; 
            }
            .petal {
                width: 80px;
                height: 40px;
                font-size: 0.7rem;
            }
            .intensity-levels {
                grid-template-columns: repeat(2, 1fr);
            }
        }
       /* Simple Responsive Fixes - Keeps Original Design */
        @media (max-width: 768px) {
            /* Prevent horizontal scroll */
            html, body {
                overflow-x: hidden;
            }
            
            /* Fix the nokashaya wheel for mobile */
            .nokashaya-wheel {
                width: 300px !important;
                height: 300px !important;
                margin: 1rem auto !important;
                position: relative;
            }
            
            .nokashaya-wheel .wheel-center {
                width: 80px !important;
                height: 80px !important;
                font-size: 0.9rem;
            }
            
            .nokashaya-wheel .petal {
                width: 80px !important;
                height: 40px !important;
                font-size: 0.7rem !important;
            }
            
            /* Make text slightly smaller on mobile */
            .game-title {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
                flex-wrap: wrap;
            }
            
            /* Stack buttons vertically on mobile */
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 80%;
                max-width: 300px;
            }
            
            /* Adjust padding for mobile */
            .lesson-section {
                padding: 1.5rem 1rem;
            }
            
            /* Make cards stack on mobile */
            .kashaya-grid, .stage-grid {
                grid-template-columns: 1fr;
            }
            
            /* Scale intensity meter for mobile */
            .intensity-container {
                padding: 2rem 1rem;
            }
            
            .kashaya-selector {
                flex-wrap: wrap;
            }
            
            .info-cards {
                grid-template-columns: 1fr;
            }
            
            /* Fix soul avatar */
            .soul-avatar {
                width: 150px;
                height: 150px;
            }
        }
        
        /* For very small screens */
        @media (max-width: 480px) {
            .nokashaya-wheel {
                width: 250px !important;
                height: 250px !important;
            }
            
            .nokashaya-wheel .petal {
                width: 70px !important;
                height: 35px !important;
                font-size: 0.6rem !important;
            }
            
            .nokashaya-wheel .wheel-center {
                width: 60px !important;
                height: 60px !important;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="soul-loader">
            <div class="karma-dust" style="animation-delay: 0s;"></div>
            <div class="karma-dust" style="animation-delay: 0.5s;"></div>
            <div class="karma-dust" style="animation-delay: 1s;"></div>
            <div class="karma-dust" style="animation-delay: 1.5s;"></div>
        </div>
        <h2 style="color: white; margin-top: 2rem;">‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂...</h2>
    </div>

    <!-- Main Menu -->
    <div class="main-menu" id="mainMenu">
        <div class="menu-container">
            <h1 class="game-title">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§æ‡§®‡•Å‡§Ø‡•ã‡§ó ‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§£‡•ç‡§°</h1>
            <p class="subtitle">‡§ö‡§∞‡§£ ‡•©: ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ</p>
            
            <div class="stage-grid">
                <div class="stage-card" onclick="startLesson()">
                    <div class="stage-icon">üî•</div>
                    <div class="stage-title">‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§∑‡§æ‡§Ø‡•á‡§Ç</div>
                    <div class="stage-description">‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§Ü‡§ï‡§∞‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à</div>
                </div>

                <div class="stage-card" onclick="startIntensityMeter()">
                    <div class="stage-icon">üìä</div>
                    <div class="stage-title">‡•ß‡•¨ ‡§ï‡§∑‡§æ‡§Ø‡•á‡§Ç</div>
                    <div class="stage-description">‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡•™ ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ú‡§æ‡§®‡•á‡§Ç</div>
                </div>

                <div class="stage-card" onclick="startNoKashaya()">
                    <div class="stage-icon">‚ò∏Ô∏è</div>
                    <div class="stage-title">‡•Ø ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø</div>
                    <div class="stage-description">‡§π‡§æ‡§∏‡•ç‡§Ø, ‡§∞‡§§‡§ø, ‡§Ö‡§∞‡§§‡§ø ‡§Ü‡§¶‡§ø ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡•á‡§Ç</div>
                </div>

                <div class="stage-card" onclick="startMinigames()">
                    <div class="stage-icon">üéÆ</div>
                    <div class="stage-title">‡§Æ‡§ø‡§®‡•Ä‡§ó‡•á‡§Æ‡•ç‡§∏</div>
                    <div class="stage-description">‡§ñ‡•á‡§≤ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§∏‡•Ä‡§ñ‡•á‡§Ç</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
        <div class="game-header">
            <button class="back-btn" onclick="backToMenu()">‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç</button>
            <div class="score-display">
                <div class="score-item">
                    <span>‚≠ê ‡§Ö‡§Ç‡§ï:</span>
                    <span id="scoreValue">0</span>
                </div>
                <div class="score-item">
                    <span>üèÜ ‡§∏‡•ç‡§§‡§∞:</span>
                    <span id="levelValue">1</span>
                </div>
            </div>
        </div>

        <div class="lesson-content" id="lessonContent">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•á!</h2>
            <p class="modal-text" id="modalText">‡§Ü‡§™‡§®‡•á ‡§Ø‡§π ‡§ñ‡§Ç‡§° ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ</p>
            <button class="action-btn" onclick="closeModal()">‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            score: 0,
            level: 1,
            currentKashaya: null,
            currentIntensity: 0,
            unlockedAchievements: [],
            learnedKashayas: [],
            learnedNoKashayas: []
        };

        // Kashaya Data from Scripture
        const kashayaData = {
            types: [
                {
                    id: 'krodha',
                    name: '‡§ï‡•ç‡§∞‡•ã‡§ß',
                    english: 'Anger',
                    icon: 'üî•',
                    color: 'anger',
                    description: '‡§Ö‡§™‡§®‡•á ‡§î‡§∞ ‡§™‡§∞ ‡§ï‡•á ‡§â‡§™‡§ò‡§æ‡§§ ‡§Ø‡§æ ‡§Ö‡§®‡•Å‡§™‡§ï‡§æ‡§∞ ‡§Ü‡§¶‡§ø ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§ï‡•ç‡§∞‡•Ç‡§∞ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ',
                    gati: '‡§®‡§∞‡§ï‡§ó‡§§‡§ø',
                    intensities: [
                        {
                            name: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä',
                            analogy: '‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï',
                            effect: '‡§∏‡§Æ‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ (‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§Æ‡§ø‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à)',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï',
                            effect: '‡§¶‡•á‡§∂‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§¨‡§æ‡§≤‡•Ç ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ (‡§π‡§µ‡§æ ‡§∏‡•á ‡§Æ‡§ø‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à)',
                            duration: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï',
                            effect: '‡§∏‡§ï‡§≤ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®',
                            analogy: '‡§ú‡§≤ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ',
                            duration: '‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§',
                            effect: '‡§Ø‡§•‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§§ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        }
                    ],
                    remedies: [
                        '‡§™‡§∞ ‡§ï‡•Ä ‡§µ‡•á‡§¶‡§®‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡•Ä ‡§µ‡•á‡§¶‡§®‡§æ ‡§∏‡§Æ‡§ù‡•á‡§Ç',
                        '‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§ï‡§∞‡•á‡§Ç',
                        '‡§Æ‡•å‡§® ‡§∞‡§π‡•á‡§Ç',
                        '‡§ä‡§™‡§∞ ‡§Ü‡§ï‡§æ‡§∂ ‡§ï‡•Ä ‡§ì‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç'
                    ]
                },
                {
                    id: 'mana',
                    name: '‡§Æ‡§æ‡§®',
                    english: 'Pride',
                    icon: 'üëë',
                    color: 'pride',
                    description: '‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ, ‡§§‡§™ ‡§î‡§∞ ‡§ú‡§æ‡§§‡§ø ‡§Ü‡§¶‡§ø ‡§ï‡•á ‡§Æ‡§¶ ‡§∏‡•á ‡§¶‡•Ç‡§∏‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§®‡§Æ‡•ç‡§∞ ‡§® ‡§π‡•ã‡§®‡§æ',
                    gati: '‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§ó‡§§‡§ø',
                    intensities: [
                        {
                            name: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä',
                            analogy: '‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï',
                            effect: '‡§∏‡§Æ‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§Ö‡§∏‡•ç‡§•‡§ø ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ (‡§™‡•Å‡§∞‡•Å‡§∑‡§æ‡§∞‡•ç‡§• ‡§∏‡•á ‡§Æ‡•Å‡§°‡§º ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à)',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï',
                            effect: '‡§¶‡•á‡§∂‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§ï‡§æ‡§∑‡•ç‡§† ‡§ï‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ (‡§™‡§ø‡§ö‡•ç‡§õ‡•Ä ‡§ï‡•Ä ‡§°‡§Ç‡§°‡•Ä)',
                            duration: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï',
                            effect: '‡§∏‡§ï‡§≤ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®',
                            analogy: '‡§≤‡§§‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠',
                            duration: '‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§',
                            effect: '‡§Ø‡§•‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§§ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        }
                    ],
                    remedies: [
                        '‡§Ö‡§™‡§®‡•á ‡§∏‡•á ‡§¨‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡•ã',
                        '‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•á ‡§Æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤‡§ú‡•ç‡§û‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç',
                        '‡§ß‡§® ‡§ï‡•á ‡§Æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ö‡§ï‡•ç‡§∞‡§µ‡§∞‡•ç‡§§‡•Ä ‡§ï‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç',
                        '‡§∞‡•Ç‡§™ ‡§ï‡•á ‡§Æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§Æ‡§¶‡•á‡§µ ‡§ï‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç'
                    ]
                },
                {
                    id: 'maya',
                    name: '‡§Æ‡§æ‡§Ø‡§æ',
                    english: 'Deceit',
                    icon: 'üé≠',
                    color: 'deceit',
                    description: '‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ï‡•ã ‡§†‡§ó‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§ü‡§ø‡§≤‡§§‡§æ ‡§Ø‡§æ ‡§õ‡§≤',
                    gati: '‡§§‡§ø‡§∞‡•ç‡§Ø‡§Ç‡§ö‡§ó‡§§‡§ø',
                    intensities: [
                        {
                            name: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä',
                            analogy: '‡§¨‡§æ‡§Ç‡§∏ ‡§ï‡•Ä ‡§ú‡§°‡§º',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï',
                            effect: '‡§∏‡§Æ‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§Æ‡•á‡§¢‡§º‡•á ‡§ï‡•á ‡§∏‡•Ä‡§Ç‡§ó (‡§¨‡§æ‡§Ç‡§∏ ‡§ï‡•Ä ‡§ú‡§°‡§º ‡§∏‡•á ‡§ï‡§Æ ‡§ü‡•á‡§¢‡§º‡•Ä)',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï',
                            effect: '‡§¶‡•á‡§∂‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞ ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® (‡§ó‡•ã ‡§ï‡•á ‡§Æ‡•Ç‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§µ‡§ï‡•ç‡§∞ ‡§∞‡•á‡§ñ‡§æ)',
                            duration: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï',
                            effect: '‡§∏‡§ï‡§≤ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®',
                            analogy: '‡§ñ‡•Å‡§∞‡§™‡•á ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® ‡§Ø‡§æ ‡§≤‡•á‡§ñ‡§®‡•Ä ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®',
                            duration: '‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§',
                            effect: '‡§Ø‡§•‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§§ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        }
                    ],
                    remedies: [
                        '‡§∏‡§æ‡§¶‡§ó‡•Ä, ‡§∏‡§∞‡§≤‡§§‡§æ',
                        '‡§à‡§Æ‡§æ‡§®‡§¶‡§æ‡§∞‡•Ä',
                        '‡§ï‡§•‡§®‡•Ä-‡§ï‡§∞‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§è‡§ï‡§∞‡•Ç‡§™‡§§‡§æ',
                        '‡§Ö‡§™‡§®‡•á ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡§æ ‡§õ‡§ø‡§™‡§æ‡§®‡§æ ‡§î‡§∞ ‡§¶‡•ã‡§∑‡•ã‡§Ç ‡§ï‡§æ ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡§æ'
                    ]
                },
                {
                    id: 'lobha',
                    name: '‡§≤‡•ã‡§≠',
                    english: 'Greed',
                    icon: 'üí∞',
                    color: 'greed',
                    description: '‡§ß‡§® ‡§Ü‡§¶‡§ø ‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞ ‡§Ü‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡§æ',
                    gati: '‡§¶‡•á‡§µ‡§ó‡§§‡§ø',
                    intensities: [
                        {
                            name: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä',
                            analogy: '‡§ï‡•É‡§Æ‡§ø‡§∞‡§æ‡§ó ‡§ï‡•á ‡§∞‡§Ç‡§ó ‡§∏‡§Æ‡§æ‡§®',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï',
                            effect: '‡§∏‡§Æ‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§ó‡§æ‡§°‡§º‡•Ä ‡§ï‡§æ ‡§ì‡§Ç‡§ó‡§® (‡§ï‡•á‡§∞‡•ã‡§∏‡§ø‡§® ‡§∏‡•á ‡§∏‡§æ‡§´ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à)',
                            duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï',
                            effect: '‡§¶‡•á‡§∂‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£',
                            analogy: '‡§ï‡•Ä‡§ö‡§°‡§º ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® (‡§ú‡§≤ ‡§∏‡•á ‡§ß‡•Å‡§≤ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à)',
                            duration: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï',
                            effect: '‡§∏‡§ï‡§≤ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        },
                        {
                            name: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®',
                            analogy: '‡§π‡§≤‡•ç‡§¶‡•Ä ‡§ï‡§æ ‡§∞‡§Ç‡§ó',
                            duration: '‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§',
                            effect: '‡§Ø‡§•‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§§ ‡§∏‡§Ç‡§Ø‡§Æ ‡§ï‡§æ ‡§ò‡§æ‡§§'
                        }
                    ],
                    remedies: [
                        '‡§∏‡§Ç‡§§‡•ã‡§∑',
                        '‡§Ö‡§™‡§∞‡§ø‡§ó‡•ç‡§∞‡§π',
                        '‡§¶‡§æ‡§®',
                        '‡§π‡§ú‡§æ‡§∞‡•ã‡§Ç ‡§®‡§¶‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Æ‡•Å‡§¶‡•ç‡§∞ ‡§ï‡•Ä ‡§§‡•É‡§™‡•ç‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•Ä - ‡§ê‡§∏‡§æ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç'
                    ]
                }
            ],
            noKashayas: [
                {
                    id: 'hasya',
                    name: '‡§π‡§æ‡§∏‡•ç‡§Ø',
                    english: 'Laughter',
                    icon: 'üòÑ',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§π‡§Å‡§∏‡•Ä ‡§Ü‡§µ‡•á‡•§'
                },
                {
                    id: 'rati',
                    name: '‡§∞‡§§‡§ø',
                    english: 'Attachment',
                    icon: '‚ù§Ô∏è',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Ü‡§¶‡§ø ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡•Ä‡§§‡§ø ‡§π‡•ã‡•§'
                },
                {
                    id: 'arati',
                    name: '‡§Ö‡§∞‡§§‡§ø',
                    english: 'Aversion',
                    icon: 'üíî',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Ü‡§¶‡§ø ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡•ç‡§∞‡•Ä‡§§‡§ø ‡§π‡•ã‡•§'
                },
                {
                    id: 'shoka',
                    name: '‡§∂‡•ã‡§ï',
                    english: 'Sorrow',
                    icon: 'üò¢',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§á‡§∑‡•ç‡§ü ‡§µ‡§ø‡§Ø‡•ã‡§ó‡§ú ‡§ï‡•ç‡§≤‡•á‡§∂ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡•§'
                },
                {
                    id: 'bhaya',
                    name: '‡§≠‡§Ø',
                    english: 'Fear',
                    icon: 'üò®',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§≠‡§Ø ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡•§'
                },
                {
                    id: 'jugupsa',
                    name: '‡§ú‡•Å‡§ó‡•Å‡§™‡•ç‡§∏‡§æ',
                    english: 'Disgust',
                    icon: 'ü§¢',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§ó‡•ç‡§≤‡§æ‡§®‡§ø ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡•§'
                },
                {
                    id: 'striveda',
                    name: '‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§µ‡•á‡§¶',
                    english: 'Feminine Inclination',
                    icon: '‚ôÄÔ∏è',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡•Ä ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡•§'
                },
                {
                    id: 'purushveda',
                    name: '‡§™‡•Å‡§∞‡•Å‡§∑‡§µ‡•á‡§¶',
                    english: 'Masculine Inclination',
                    icon: '‚ôÇÔ∏è',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§™‡•Å‡§∞‡•Å‡§∑ ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡•Ä ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡•§'
                },
                {
                    id: 'napumsakveda',
                    name: '‡§®‡§™‡•Å‡§Ç‡§∏‡§ï‡§µ‡•á‡§¶',
                    english: 'Neuter Inclination',
                    icon: '‚ößÔ∏è',
                    definition: '‡§ú‡§ø‡§∏‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§®‡§™‡•Å‡§Ç‡§∏‡§ï ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡•Ä ‡§≠‡§æ‡§µ‡•ã‡§Ç ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡•§'
                }
            ]
        };

        // Initialize
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainMenu').classList.add('active');
            }, 2000);
        };

        // Start Lesson - Karma Magnet
        function startLesson() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section fade-in">
                    <h2 class="section-title">
                        <span>üß≤</span>
                        <span>‡§ï‡§∞‡•ç‡§Æ ‡§ö‡•Å‡§Æ‡•ç‡§¨‡§ï - ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡•ã ‡§Ü‡§ï‡§∞‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à</span>
                    </h2>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem;">
                        ‡§ú‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•ã ‡§∏‡§Ç‡§∏‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§≠‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§∞‡§æ‡§§‡•Ä ‡§π‡•à, ‡§µ‡§π ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§π‡§≤‡§æ‡§§‡•Ä ‡§π‡•à‡•§ 
                        ‡§ï‡§∑‡§æ‡§Ø ‡§ö‡•Å‡§Æ‡•ç‡§¨‡§ï ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§® ‡§π‡•à, ‡§ú‡§ø‡§∏‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡§∞‡•ç‡§Æ ‡§ö‡§ø‡§™‡§ï ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§
                        ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞‡•Ä ‡§ï‡§≤‡•Å‡§∑ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç‡•§
                    </p>
                    
                    <div class="soul-container">
                        <div class="soul-avatar" id="soulAvatar"></div>
                    </div>
                    
                    <div class="kashaya-grid">
                        ${kashayaData.types.map(k => `
                            <div class="kashaya-card ${k.color}" onclick="showKashayaEffect('${k.id}')">
                                <span class="kashaya-icon">${k.icon}</span>
                                <div class="kashaya-name">${k.name} (${k.english})</div>
                                <div style="font-size: 0.9rem; margin-top: 0.5rem;">
                                    ${k.description}
                                </div>
                                <div style="font-size: 0.85rem; margin-top: 1rem; opacity: 0.9;">
                                    ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§ó‡§§‡§ø: ${k.gati}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startQuiz()">‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ üìù</button>
                        <button class="action-btn" onclick="showRemedies()">‡§â‡§™‡§ö‡§æ‡§∞ ‡§ú‡§æ‡§®‡•á‡§Ç üíä</button>
                    </div>
                </div>
            `;
        }

        // Show Kashaya Effect on Soul
        function showKashayaEffect(kashayaId) {
            const kashaya = kashayaData.types.find(k => k.id === kashayaId);
            const soul = document.getElementById('soulAvatar');
            
            // Dim the soul
            soul.classList.add('dimmed');
            
            // Add karma particles
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'karma-particle';
                    particle.style.width = Math.random() * 10 + 5 + 'px';
                    particle.style.height = particle.style.width;
                    particle.style.background = getKashayaColor(kashaya.color);
                    particle.style.left = Math.random() * 180 + 10 + 'px';
                    particle.style.top = Math.random() * 180 + 10 + 'px';
                    soul.appendChild(particle);
                }, i * 50);
            }
            
            // Show info
            showModal(
                `${kashaya.name} ‡§ï‡§∑‡§æ‡§Ø`,
                `<div style="text-align: left;">
                    <p><strong>‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§æ:</strong> ${kashaya.description}</p>
                    <p><strong>‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ó‡§§‡§ø:</strong> ${kashaya.gati}</p>
                    <p><strong>‡§™‡•ç‡§∞‡§≠‡§æ‡§µ:</strong> ‡§Ø‡§π ‡§ï‡§∑‡§æ‡§Ø ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•ã ‡§ï‡§∞‡•ç‡§Æ ‡§∏‡•á ‡§¨‡§æ‡§Ç‡§ß‡§§‡•Ä ‡§π‡•à ‡§î‡§∞ ${kashaya.gati} ‡§Æ‡•á‡§Ç ‡§≤‡•á ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§</p>
                </div>`
            );
            
            updateScore(50);
            if (!gameState.learnedKashayas.includes(kashayaId)) {
                gameState.learnedKashayas.push(kashayaId);
                if (gameState.learnedKashayas.length === 4) {
                    showAchievement('‡§ï‡§∑‡§æ‡§Ø ‡§µ‡§ø‡§¶‡•ç‡§µ‡§æ‡§®', '‡§∏‡§≠‡•Ä ‡•™ ‡§ï‡§∑‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Ä‡§ñ‡§æ!');
                }
            }
        }

        function getKashayaColor(type) {
            switch(type) {
                case 'anger': return '#DC143C';
                case 'pride': return '#4169E1';
                case 'deceit': return '#FF8C00';
                case 'greed': return '#228B22';
                default: return '#8B4513';
            }
        }

        // Start Intensity Meter
        <!-- Replace the startIntensityMeter() function with this updated version -->


        // Updated Intensity Meter with Professional Visuals
        function startIntensityMeter() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <style>
                    .intensity-container {
                        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                        border-radius: 20px;
                        padding: 3rem;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .intensity-container::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        left: -50%;
                        width: 200%;
                        height: 200%;
                        background: radial-gradient(circle, rgba(147,112,219,0.1) 0%, transparent 70%);
                        animation: rotate 20s linear infinite;
                    }
                    
                    @keyframes rotate {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    
                    .intensity-header {
                        text-align: center;
                        color: white;
                        position: relative;
                        z-index: 1;
                    }
                    
                    .intensity-title {
                        font-size: 2.5rem;
                        font-weight: bold;
                        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        margin-bottom: 1rem;
                    }
                    
                    .kashaya-selector {
                        display: flex;
                        justify-content: center;
                        gap: 1rem;
                        margin: 2rem 0;
                        flex-wrap: wrap;
                    }
                    
                    .kashaya-btn {
                        padding: 1rem 2rem;
                        border: none;
                        border-radius: 50px;
                        color: white;
                        font-size: 1.1rem;
                        cursor: pointer;
                        transition: all 0.3s;
                        position: relative;
                        overflow: hidden;
                        font-family: 'Noto Sans Devanagari', sans-serif;
                    }
                    
                    .kashaya-btn::before {
                        content: '';
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        width: 0;
                        height: 0;
                        border-radius: 50%;
                        background: rgba(255,255,255,0.3);
                        transform: translate(-50%, -50%);
                        transition: width 0.6s, height 0.6s;
                    }
                    
                    .kashaya-btn:hover::before {
                        width: 300px;
                        height: 300px;
                    }
                    
                    .kashaya-btn.anger {
                        background: linear-gradient(135deg, #FF6B6B 0%, #C92A2A 100%);
                        box-shadow: 0 10px 30px rgba(255,107,107,0.3);
                    }
                    
                    .kashaya-btn.pride {
                        background: linear-gradient(135deg, #4C6EF5 0%, #364FC7 100%);
                        box-shadow: 0 10px 30px rgba(76,110,245,0.3);
                    }
                    
                    .kashaya-btn.deceit {
                        background: linear-gradient(135deg, #FFA94D 0%, #FD7E14 100%);
                        box-shadow: 0 10px 30px rgba(255,169,77,0.3);
                    }
                    
                    .kashaya-btn.greed {
                        background: linear-gradient(135deg, #51CF66 0%, #2B8A3E 100%);
                        box-shadow: 0 10px 30px rgba(81,207,102,0.3);
                    }
                    
                    .kashaya-btn.active {
                        transform: scale(1.1);
                        box-shadow: 0 15px 40px rgba(255,255,255,0.2);
                    }
                    
                    .visual-display {
                        background: rgba(255,255,255,0.05);
                        border-radius: 20px;
                        padding: 2rem;
                        margin: 2rem 0;
                        min-height: 400px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        backdrop-filter: blur(10px);
                        border: 1px solid rgba(255,255,255,0.1);
                    }
                    
                    .intensity-slider-container {
                        margin: 3rem 0;
                        position: relative;
                    }
                    
                    .custom-slider {
                        width: 100%;
                        height: 60px;
                        background: rgba(255,255,255,0.1);
                        border-radius: 30px;
                        position: relative;
                        cursor: pointer;
                        overflow: hidden;
                    }
                    
                    .slider-track {
                        position: absolute;
                        height: 100%;
                        background: linear-gradient(90deg, 
                            #FF6B6B 0%, 
                            #FFA94D 33%, 
                            #51CF66 66%, 
                            #4C6EF5 100%);
                        border-radius: 30px;
                        width: 25%;
                        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                    }
                    
                    .slider-thumb {
                        position: absolute;
                        width: 80px;
                        height: 80px;
                        background: white;
                        border-radius: 50%;
                        top: 50%;
                        transform: translate(-50%, -50%);
                        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                        cursor: grab;
                        transition: all 0.3s;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 2rem;
                    }
                    
                    .slider-thumb:active {
                        cursor: grabbing;
                        transform: translate(-50%, -50%) scale(1.2);
                    }
                    
                    .intensity-marks {
                        display: flex;
                        justify-content: space-between;
                        margin-top: 1rem;
                        padding: 0 40px;
                    }
                    
                    .intensity-mark {
                        color: rgba(255,255,255,0.6);
                        font-size: 0.9rem;
                        text-align: center;
                        transition: all 0.3s;
                    }
                    
                    .intensity-mark.active {
                        color: #FFD700;
                        transform: scale(1.2);
                        font-weight: bold;
                    }
                    
                    .info-cards {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                        gap: 1.5rem;
                        margin-top: 2rem;
                    }
                    
                    .info-card {
                        background: rgba(255,255,255,0.1);
                        backdrop-filter: blur(10px);
                        border-radius: 15px;
                        padding: 1.5rem;
                        border: 1px solid rgba(255,255,255,0.2);
                        transition: all 0.3s;
                    }
                    
                    .info-card:hover {
                        transform: translateY(-5px);
                        background: rgba(255,255,255,0.15);
                        box-shadow: 0 10px 30px rgba(147,112,219,0.3);
                    }
                    
                    .info-card h3 {
                        color: #FFD700;
                        margin-bottom: 0.5rem;
                        font-size: 1.2rem;
                    }
                    
                    .info-card p {
                        color: rgba(255,255,255,0.9);
                        line-height: 1.6;
                    }
                    
                    .analogy-animation {
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .fade-in {
                        animation: fadeIn 0.5s ease-in;
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; transform: scale(0.9); }
                        to { opacity: 1; transform: scale(1); }
                    }
                </style>
                
                <div class="intensity-container">
                    <div class="intensity-header">
                        <h1 class="intensity-title">‡§ï‡§∑‡§æ‡§Ø ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§Æ‡•Ä‡§ü‡§∞</h1>
                        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">
                            ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡•™ ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ‡§è‡§Ç - ‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§ï‡§∞‡•á‡§Ç
                        </p>
                    </div>
                    
                    <div class="kashaya-selector">
                        <button class="kashaya-btn anger" onclick="selectKashayaType('krodha')" id="btn-krodha">
                            üî• ‡§ï‡•ç‡§∞‡•ã‡§ß
                        </button>
                        <button class="kashaya-btn pride" onclick="selectKashayaType('mana')" id="btn-mana">
                            üëë ‡§Æ‡§æ‡§®
                        </button>
                        <button class="kashaya-btn deceit" onclick="selectKashayaType('maya')" id="btn-maya">
                            üé≠ ‡§Æ‡§æ‡§Ø‡§æ
                        </button>
                        <button class="kashaya-btn greed" onclick="selectKashayaType('lobha')" id="btn-lobha">
                            üí∞ ‡§≤‡•ã‡§≠
                        </button>
                    </div>
                    
                    <div class="visual-display" id="visualDisplay">
                        <div id="analogyVisual" class="analogy-animation">
                            <!-- Dynamic SVG animations will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="intensity-slider-container">
                        <div class="custom-slider" id="customSlider">
                            <div class="slider-track" id="sliderTrack"></div>
                            <div class="slider-thumb" id="sliderThumb" style="left: 12.5%;">
                                <span id="thumbIcon">ü™®</span>
                            </div>
                        </div>
                        <div class="intensity-marks">
                            <div class="intensity-mark active" id="mark-0">
                                <div>‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä</div>
                                <div style="font-size: 0.8rem; margin-top: 0.3rem;">‡§∏‡§¨‡§∏‡•á ‡§§‡•Ä‡§µ‡•ç‡§∞</div>
                            </div>
                            <div class="intensity-mark" id="mark-1">
                                <div>‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£</div>
                                <div style="font-size: 0.8rem; margin-top: 0.3rem;">‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§§‡•Ä‡§µ‡•ç‡§∞</div>
                            </div>
                            <div class="intensity-mark" id="mark-2">
                                <div>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£</div>
                                <div style="font-size: 0.8rem; margin-top: 0.3rem;">‡§Æ‡§ß‡•ç‡§Ø‡§Æ</div>
                            </div>
                            <div class="intensity-mark" id="mark-3">
                                <div>‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®</div>
                                <div style="font-size: 0.8rem; margin-top: 0.3rem;">‡§∏‡§¨‡§∏‡•á ‡§Æ‡§Ç‡§¶</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-cards">
                        <div class="info-card">
                            <h3>üìñ ‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§</h3>
                            <p id="analogyText">‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ</p>
                        </div>
                        <div class="info-card">
                            <h3>‚è±Ô∏è ‡§Ö‡§µ‡§ß‡§ø</h3>
                            <p id="durationText">‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï</p>
                        </div>
                        <div class="info-card">
                            <h3>‚ö° ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ</h3>
                            <p id="effectText">‡§∏‡§Æ‡•ç‡§Ø‡§ï‡•ç‡§§‡•ç‡§µ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§ò‡§æ‡§§</p>
                        </div>
                        <div class="info-card">
                            <h3>üåç ‡§ó‡§§‡§ø</h3>
                            <p id="gatiText">‡§®‡§∞‡§ï‡§ó‡§§‡§ø ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§§‡§æ ‡§π‡•à</p>
                        </div>
                    </div>
                    
                    <div class="action-buttons" style="margin-top: 3rem; text-align: center;">
                        <button class="action-btn" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; padding: 1rem 3rem; font-size: 1.2rem;" onclick="testIntensityKnowledge()">
                            ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§≤‡•á‡§Ç
                        </button>
                    </div>
                </div>
            `;
            
            // Initialize with first kashaya
            gameState.currentKashaya = 'krodha';
            gameState.currentIntensity = 0;
            selectKashayaType('krodha');
            setupSliderInteraction();
        }

        function selectKashayaType(kashayaId) {
            gameState.currentKashaya = kashayaId;
            gameState.currentIntensity = 0;
            
            // Update button states
            document.querySelectorAll('.kashaya-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn-${kashayaId}`).classList.add('active');
            
            // Reset slider position
            const thumb = document.getElementById('sliderThumb');
            thumb.style.left = '12.5%';
            document.getElementById('sliderTrack').style.width = '25%';
            
            // Update marks
            document.querySelectorAll('.intensity-mark').forEach((mark, i) => {
                mark.classList.toggle('active', i === 0);
            });
            
            // Update display
            updateIntensityVisual(kashayaId, 0);
        }

        function updateIntensityVisual(kashayaId, level) {
            const kashaya = kashayaData.types.find(k => k.id === kashayaId);
            const intensity = kashaya.intensities[level];
            
            // Update info cards with animation
            const cards = document.querySelectorAll('.info-card');
            cards.forEach(card => {
                card.style.animation = 'none';
                setTimeout(() => {
                    card.style.animation = 'fadeIn 0.5s ease-in';
                }, 50);
            });
            
            document.getElementById('analogyText').textContent = intensity.analogy;
            document.getElementById('durationText').textContent = intensity.duration;
            document.getElementById('effectText').textContent = intensity.effect;
            document.getElementById('gatiText').textContent = `${kashaya.gati} ‡§ï‡•Ä ‡§ì‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§§‡§æ ‡§π‡•à`;
            
            // Update visual display with sophisticated SVG animation
            const visualDisplay = document.getElementById('analogyVisual');
            visualDisplay.className = 'analogy-animation fade-in';
            
            // Create sophisticated visual based on kashaya and intensity
            visualDisplay.innerHTML = getIntensityVisual(kashayaId, level);
            
            // Update thumb icon
            const thumbIcons = {
                krodha: ['ü™®', 'üåç', 'üèñÔ∏è', 'üíß'],
                mana: ['üóø', 'ü¶¥', 'ü™µ', 'üåø'],
                maya: ['üéã', 'üêè', 'üêÑ', '‚úèÔ∏è'],
                lobha: ['üêõ', 'üõ¢Ô∏è', 'üü´', 'üü°']
            };
            document.getElementById('thumbIcon').textContent = thumbIcons[kashayaId][level];
            
            updateScore(25);
        }

        function getIntensityVisual(kashayaId, level) {
            const visuals = {
                krodha: [
                    // Stone line - Most permanent
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <pattern id="stonePattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                                <rect fill="#8B7355" width="40" height="40"/>
                                <circle fill="#6B5D54" cx="10" cy="10" r="5"/>
                                <circle fill="#9A8B7A" cx="30" cy="25" r="3"/>
                            </pattern>
                            <filter id="roughPaper">
                                <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise"/>
                                <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="1">
                                    <feDistantLight azimuth="45" elevation="60"/>
                                </feDiffuseLighting>
                            </filter>
                        </defs>
                        <rect x="50" y="140" width="300" height="20" fill="url(#stonePattern)" filter="url(#roughPaper)"/>
                        <path d="M 50 150 L 350 150" stroke="#4A4A4A" stroke-width="3" stroke-linecap="round">
                            <animate attributeName="stroke-dasharray" values="0 300;300 0" dur="2s" fill="freeze"/>
                        </path>
                        <text x="200" y="190" text-anchor="middle" fill="white" font-size="14" opacity="0">
                            ‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§ï‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§ü‡§§‡•Ä
                            <animate attributeName="opacity" from="0" to="1" dur="1s" begin="2s" fill="freeze"/>
                        </text>
                    </svg>`,
                    
                    // Earth line - Can be washed away
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <pattern id="earthPattern" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
                                <rect fill="#8B6914" width="30" height="30"/>
                                <circle fill="#A0826D" cx="15" cy="15" r="8" opacity="0.5"/>
                            </pattern>
                        </defs>
                        <rect x="50" y="140" width="300" height="20" fill="url(#earthPattern)" opacity="0.8"/>
                        <path d="M 50 150 L 350 150" stroke="#654321" stroke-width="3" stroke-linecap="round">
                            <animate attributeName="stroke-dasharray" values="0 300;300 0" dur="2s" fill="freeze"/>
                        </path>
                        <g opacity="0">
                            <rect x="50" y="120" width="300" height="60" fill="url(#waterGradient)" opacity="0.6"/>
                            <animate attributeName="opacity" from="0" to="1" dur="1s" begin="3s" fill="freeze"/>
                        </g>
                        <text x="200" y="190" text-anchor="middle" fill="white" font-size="14" opacity="0">
                            ‡§≠‡•Ç‡§Æ‡§ø ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§Æ‡§ø‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à
                            <animate attributeName="opacity" from="0" to="1" dur="1s" begin="2s" fill="freeze"/>
                        </text>
                        <defs>
                            <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:0.3"/>
                                <stop offset="100%" style="stop-color:#7FCDFF;stop-opacity:0.1"/>
                            </linearGradient>
                        </defs>
                    </svg>`,
                    
                    // Sand line - Blown by wind
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <pattern id="sandPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                                <rect fill="#F4E4C1" width="20" height="20"/>
                                <circle fill="#E8D4B0" cx="10" cy="10" r="2"/>
                            </pattern>
                        </defs>
                        <rect x="50" y="140" width="300" height="20" fill="url(#sandPattern)" opacity="0.7"/>
                        <path d="M 50 150 L 350 150" stroke="#D4A76A" stroke-width="2" stroke-linecap="round">
                            <animate attributeName="stroke-dasharray" values="0 300;300 0" dur="1.5s" fill="freeze"/>
                            <animateTransform attributeName="transform" type="translate" 
                                values="0,0; 5,0; 0,0; -5,0; 0,0" dur="2s" begin="2s" repeatCount="indefinite"/>
                        </path>
                        <g id="windEffect">
                            <path d="M 30 140 Q 100 135, 150 140" stroke="rgba(255,255,255,0.4)" stroke-width="2" fill="none">
                                <animate attributeName="d" 
                                    values="M 30 140 Q 100 135, 150 140;M 50 145 Q 120 140, 170 145;M 30 140 Q 100 135, 150 140" 
                                    dur="3s" repeatCount="indefinite"/>
                            </path>
                        </g>
                        <text x="200" y="190" text-anchor="middle" fill="white" font-size="14" opacity="0">
                            ‡§¨‡§æ‡§≤‡•Ç ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§π‡§µ‡§æ ‡§∏‡•á ‡§Æ‡§ø‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à
                            <animate attributeName="opacity" from="0" to="1" dur="1s" begin="1.5s" fill="freeze"/>
                        </text>
                    </svg>`,
                    
                    // Water line - Disappears immediately
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="waterLine" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#4FC3F7;stop-opacity:0.8"/>
                                <stop offset="50%" style="stop-color:#29B6F6;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#4FC3F7;stop-opacity:0.8"/>
                            </linearGradient>
                        </defs>
                        <path d="M 50 150 Q 100 140, 150 150 T 250 150 T 350 150" 
                            stroke="url(#waterLine)" stroke-width="3" fill="none">
                            <animate attributeName="stroke-opacity" values="0;1;1;0" dur="3s" repeatCount="indefinite"/>
                            <animate attributeName="d" 
                                values="M 50 150 Q 100 140, 150 150 T 250 150 T 350 150;
                                        M 50 150 Q 100 160, 150 150 T 250 150 T 350 150;
                                        M 50 150 Q 100 140, 150 150 T 250 150 T 350 150" 
                                dur="2s" repeatCount="indefinite"/>
                        </path>
                        <g id="ripples">
                            <circle cx="200" cy="150" r="10" fill="none" stroke="#4FC3F7" stroke-width="1" opacity="0">
                                <animate attributeName="r" from="10" to="50" dur="2s" repeatCount="indefinite"/>
                                <animate attributeName="opacity" values="0;0.5;0" dur="2s" repeatCount="indefinite"/>
                            </circle>
                        </g>
                        <text x="200" y="190" text-anchor="middle" fill="white" font-size="14">
                            ‡§ú‡§≤ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Æ‡§ø‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à
                        </text>
                    </svg>`
                ],
                mana: [
                    // Stone pillar
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="stonePillar" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#8B8C8D;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#5A5B5C;stop-opacity:1"/>
                            </linearGradient>
                            <pattern id="stoneTexture" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
                                <rect fill="#7A7B7C" width="50" height="50"/>
                                <circle fill="#6A6B6C" cx="25" cy="25" r="10" opacity="0.5"/>
                            </pattern>
                        </defs>
                        <rect x="175" y="50" width="50" height="200" fill="url(#stonePillar)"/>
                        <rect x="175" y="50" width="50" height="200" fill="url(#stoneTexture)" opacity="0.5"/>
                        <rect x="175" y="50" width="50" height="10" fill="#6A6B6C"/>
                        <rect x="175" y="240" width="50" height="10" fill="#6A6B6C"/>
                        <text x="200" y="270" text-anchor="middle" fill="white" font-size="14">
                            ‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ - ‡§Ö‡§ü‡§≤ ‡§î‡§∞ ‡§ï‡§†‡•ã‡§∞
                        </text>
                    </svg>`,
                    
                    // Bone pillar
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="bonePillar" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#F5F5DC;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#D3D3C0;stop-opacity:1"/>
                            </linearGradient>
                        </defs>
                        <ellipse cx="200" cy="60" rx="25" ry="15" fill="url(#bonePillar)"/>
                        <rect x="185" y="60" width="30" height="180" fill="url(#bonePillar)"/>
                        <ellipse cx="200" cy="240" rx="25" ry="15" fill="url(#bonePillar)"/>
                        <path d="M 185 100 Q 180 150, 185 200" stroke="#C0C0A0" stroke-width="2" fill="none" opacity="0.5"/>
                        <path d="M 215 100 Q 220 150, 215 200" stroke="#C0C0A0" stroke-width="2" fill="none" opacity="0.5"/>
                        <path d="M 200 60 Q 195 150, 200 240" stroke="none" fill="none">
                            <animateTransform attributeName="transform" type="rotate" 
                                values="0 200 150;2 200 150;0 200 150;-2 200 150;0 200 150" 
                                dur="4s" repeatCount="indefinite"/>
                        </path>
                        <text x="200" y="270" text-anchor="middle" fill="white" font-size="14">
                            ‡§Ö‡§∏‡•ç‡§•‡§ø ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ - ‡§™‡•Å‡§∞‡•Å‡§∑‡§æ‡§∞‡•ç‡§• ‡§∏‡•á ‡§Æ‡•Å‡§°‡§º ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
                        </text>
                    </svg>`,
                    
                    // Wood pillar
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <pattern id="woodGrain" x="0" y="0" width="30" height="100" patternUnits="userSpaceOnUse">
                                <rect fill="#8B4513" width="30" height="100"/>
                                <path d="M 0 20 Q 15 25, 30 20" stroke="#654321" stroke-width="1" fill="none"/>
                                <path d="M 0 50 Q 15 45, 30 50" stroke="#654321" stroke-width="1" fill="none"/>
                                <path d="M 0 80 Q 15 85, 30 80" stroke="#654321" stroke-width="1" fill="none"/>
                            </pattern>
                        </defs>
                        <rect x="185" y="50" width="30" height="200" fill="url(#woodGrain)"/>
                        <ellipse cx="200" cy="50" rx="15" ry="5" fill="#654321"/>
                        <ellipse cx="200" cy="250" rx="15" ry="5" fill="#654321"/>
                        <g opacity="0.5">
                            <circle cx="195" cy="100" r="3" fill="#4A2C17"/>
                            <circle cx="205" cy="150" r="2" fill="#4A2C17"/>
                            <circle cx="195" cy="200" r="3" fill="#4A2C17"/>
                        </g>
                        <text x="200" y="270" text-anchor="middle" fill="white" font-size="14">
                            ‡§ï‡§æ‡§∑‡•ç‡§† ‡§ï‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ - ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§≤‡§ö‡•Ä‡§≤‡§æ
                        </text>
                    </svg>`,
                    
                    // Vine pillar
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="vineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#7CB342;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#558B2F;stop-opacity:1"/>
                            </linearGradient>
                        </defs>
                        <path d="M 200 50 Q 180 100, 200 150 T 200 250" 
                            stroke="url(#vineGradient)" stroke-width="8" fill="none">
                            <animate attributeName="d" 
                                values="M 200 50 Q 180 100, 200 150 T 200 250;
                                        M 200 50 Q 220 100, 200 150 T 200 250;
                                        M 200 50 Q 180 100, 200 150 T 200 250" 
                                dur="3s" repeatCount="indefinite"/>
                        </path>
                        <g id="leaves">
                            <ellipse cx="185" cy="80" rx="8" ry="12" fill="#66BB6A" transform="rotate(-30 185 80)">
                                <animateTransform attributeName="transform" type="rotate" 
                                    values="-30 185 80;-35 185 80;-30 185 80" dur="2s" repeatCount="indefinite"/>
                            </ellipse>
                            <ellipse cx="215" cy="120" rx="8" ry="12" fill="#66BB6A" transform="rotate(30 215 120)">
                                <animateTransform attributeName="transform" type="rotate" 
                                    values="30 215 120;35 215 120;30 215 120" dur="2.5s" repeatCount="indefinite"/>
                            </ellipse>
                            <ellipse cx="185" cy="180" rx="8" ry="12" fill="#66BB6A" transform="rotate(-25 185 180)">
                                <animateTransform attributeName="transform" type="rotate" 
                                    values="-25 185 180;-30 185 180;-25 185 180" dur="2.2s" repeatCount="indefinite"/>
                            </ellipse>
                        </g>
                        <text x="200" y="270" text-anchor="middle" fill="white" font-size="14">
                            ‡§≤‡§§‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠ - ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§≤‡§ö‡•Ä‡§≤‡§æ
                        </text>
                    </svg>`
                ],
                maya: [
                    // Bamboo root - most crooked
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="bambooRoot" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8B7355;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#5C4033;stop-opacity:1"/>
                            </linearGradient>
                        </defs>
                        <path d="M 50 150 Q 100 100, 150 150 T 250 150 Q 300 200, 350 150" 
                            stroke="url(#bambooRoot)" stroke-width="6" fill="none"/>
                        <path d="M 80 160 Q 90 140, 110 155" stroke="#5C4033" stroke-width="3" fill="none"/>
                        <path d="M 180 145 Q 190 165, 210 150" stroke="#5C4033" stroke-width="3" fill="none"/>
                        <path d="M 280 155 Q 290 135, 310 150" stroke="#5C4033" stroke-width="3" fill="none"/>
                        <g id="rootHairs">
                            <path d="M 100 140 L 95 130" stroke="#6B5D54" stroke-width="1"/>
                            <path d="M 150 155 L 145 165" stroke="#6B5D54" stroke-width="1"/>
                            <path d="M 200 145 L 195 135" stroke="#6B5D54" stroke-width="1"/>
                            <path d="M 250 155 L 255 165" stroke="#6B5D54" stroke-width="1"/>
                        </g>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§¨‡§æ‡§Ç‡§∏ ‡§ï‡•Ä ‡§ú‡§°‡§º - ‡§Ö‡§§‡•ç‡§Ø‡§Ç‡§§ ‡§ï‡•Å‡§ü‡§ø‡§≤
                        </text>
                    </svg>`,
                    
                    // Ram's horn
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="hornGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#D2B48C;stop-opacity:1"/>
                                <stop offset="50%" style="stop-color:#BC9A6A;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#D2B48C;stop-opacity:1"/>
                            </linearGradient>
                        </defs>
                        <path d="M 100 150 Q 150 100, 200 130 Q 250 160, 300 140" 
                            stroke="url(#hornGradient)" stroke-width="8" fill="none" stroke-linecap="round"/>
                        <path d="M 100 150 Q 150 105, 200 130 Q 250 155, 300 140" 
                            stroke="#BC9A6A" stroke-width="4" fill="none" opacity="0.5"/>
                        <g id="hornTexture">
                            <path d="M 120 140 Q 125 135, 130 140" stroke="#A0826D" stroke-width="1" opacity="0.6"/>
                            <path d="M 160 120 Q 165 115, 170 120" stroke="#A0826D" stroke-width="1" opacity="0.6"/>
                            <path d="M 220 140 Q 225 135, 230 140" stroke="#A0826D" stroke-width="1" opacity="0.6"/>
                        </g>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§Æ‡•á‡§¢‡§º‡•á ‡§ï‡•á ‡§∏‡•Ä‡§Ç‡§ó - ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§ï‡•Å‡§ü‡§ø‡§≤
                        </text>
                    </svg>`,
                    
                    // Cow's urine stream
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="urineStream" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#F4E4C1;stop-opacity:0.8"/>
                                <stop offset="100%" style="stop-color:#E8D4B0;stop-opacity:0.6"/>
                            </linearGradient>
                        </defs>
                        <path d="M 50 100 Q 100 150, 150 140 T 250 160 Q 300 150, 350 180" 
                            stroke="url(#urineStream)" stroke-width="4" fill="none" stroke-linecap="round">
                            <animate attributeName="stroke-dasharray" values="0 400;400 0" dur="2s" repeatCount="indefinite"/>
                        </path>
                        <g id="drops" opacity="0.6">
                            <circle cx="150" cy="140" r="2" fill="#E8D4B0">
                                <animate attributeName="cy" values="140;160;140" dur="1.5s" repeatCount="indefinite"/>
                            </circle>
                            <circle cx="250" cy="160" r="2" fill="#E8D4B0">
                                <animate attributeName="cy" values="160;180;160" dur="1.8s" repeatCount="indefinite"/>
                            </circle>
                        </g>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§ó‡•ã‡§Æ‡•Ç‡§§‡•ç‡§∞ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§π‡§≤‡•ç‡§ï‡•Ä ‡§µ‡§ï‡•ç‡§∞‡§§‡§æ
                        </text>
                    </svg>`,
                    
                    // Pen stroke
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <linearGradient id="inkGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#1E3A8A;stop-opacity:0.3"/>
                                <stop offset="50%" style="stop-color:#1E3A8A;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#1E3A8A;stop-opacity:0.3"/>
                            </linearGradient>
                        </defs>
                        <path d="M 50 150 Q 100 145, 150 150 T 250 150 T 350 150" 
                            stroke="url(#inkGradient)" stroke-width="2" fill="none" stroke-linecap="round">
                            <animate attributeName="stroke-dasharray" values="0 300;300 0" dur="1.5s" fill="freeze"/>
                        </path>
                        <g id="penTip" transform="translate(350, 150)">
                            <path d="M 0 0 L 10 -5 L 10 5 Z" fill="#1E3A8A">
                                <animateTransform attributeName="transform" type="translate" 
                                    values="0,0; -300,0" dur="1.5s" fill="freeze"/>
                            </path>
                        </g>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§≤‡•á‡§ñ‡§®‡•Ä ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ - ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§µ‡§ï‡•ç‡§∞‡§§‡§æ
                        </text>
                    </svg>`
                ],
                lobha: [
                    // Worm color - deepest stain
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <radialGradient id="wormStain">
                                <stop offset="0%" style="stop-color:#8B0000;stop-opacity:1"/>
                                <stop offset="50%" style="stop-color:#660000;stop-opacity:0.9"/>
                                <stop offset="100%" style="stop-color:#330000;stop-opacity:0.8"/>
                            </radialGradient>
                            <filter id="organic">
                                <feTurbulence type="turbulence" baseFrequency="0.02" numOctaves="3"/>
                                <feColorMatrix values="0 0 0 0 0.5
                                                    0 0 0 0 0
                                                    0 0 0 0 0
                                                    0 0 0 1 0"/>
                            </filter>
                        </defs>
                        <ellipse cx="200" cy="150" rx="120" ry="80" fill="url(#wormStain)" filter="url(#organic)" opacity="0.9">
                            <animate attributeName="rx" values="120;130;120" dur="3s" repeatCount="indefinite"/>
                            <animate attributeName="ry" values="80;85;80" dur="3s" repeatCount="indefinite"/>
                        </ellipse>
                        <ellipse cx="180" cy="140" rx="30" ry="20" fill="#660000" opacity="0.5"/>
                        <ellipse cx="220" cy="160" rx="25" ry="18" fill="#660000" opacity="0.5"/>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§ï‡•É‡§Æ‡§ø‡§∞‡§æ‡§ó ‡§ï‡§æ ‡§∞‡§Ç‡§ó - ‡§ó‡§π‡§∞‡§æ ‡§î‡§∞ ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä
                        </text>
                    </svg>`,
                    
                    // Oil stain
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <radialGradient id="oilStain">
                                <stop offset="0%" style="stop-color:#3E2723;stop-opacity:1"/>
                                <stop offset="50%" style="stop-color:#5D4037;stop-opacity:0.8"/>
                                <stop offset="100%" style="stop-color:#795548;stop-opacity:0.6"/>
                            </radialGradient>
                        </defs>
                        <ellipse cx="200" cy="150" rx="100" ry="70" fill="url(#oilStain)">
                            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
                        </ellipse>
                        <ellipse cx="200" cy="150" rx="80" ry="55" fill="none" stroke="#8D6E63" stroke-width="2" opacity="0.5"/>
                        <ellipse cx="200" cy="150" rx="60" ry="40" fill="none" stroke="#A1887F" stroke-width="1" opacity="0.3"/>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§§‡•á‡§≤ ‡§ï‡§æ ‡§¶‡§æ‡§ó - ‡§ï‡•á‡§∞‡•ã‡§∏‡§ø‡§® ‡§∏‡•á ‡§∏‡§æ‡§´ ‡§π‡•ã‡§§‡§æ ‡§π‡•à
                        </text>
                    </svg>`,
                    
                    // Mud stain
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <pattern id="mudPattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                                <rect fill="#6D4C41" width="40" height="40"/>
                                <circle fill="#5D4037" cx="20" cy="20" r="8" opacity="0.6"/>
                                <circle fill="#4E342E" cx="10" cy="30" r="5" opacity="0.5"/>
                            </pattern>
                        </defs>
                        <ellipse cx="200" cy="150" rx="90" ry="60" fill="url(#mudPattern)" opacity="0.7"/>
                        <path d="M 150 150 Q 200 130, 250 150" fill="#5D4037" opacity="0.4"/>
                        <g opacity="0">
                            <rect x="110" y="120" width="180" height="60" fill="#4FC3F7" opacity="0.3"/>
                            <animate attributeName="opacity" from="0" to="1" begin="2s" dur="1s" fill="freeze"/>
                        </g>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§ï‡•Ä‡§ö‡§°‡§º ‡§ï‡§æ ‡§¶‡§æ‡§ó - ‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ß‡•Å‡§≤ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à
                        </text>
                    </svg>`,
                    
                    // Turmeric stain
                    `<svg width="400" height="300" viewBox="0 0 400 300">
                        <defs>
                            <radialGradient id="turmericStain">
                                <stop offset="0%" style="stop-color:#FFD54F;stop-opacity:0.8"/>
                                <stop offset="50%" style="stop-color:#FFCA28;stop-opacity:0.6"/>
                                <stop offset="100%" style="stop-color:#FFB300;stop-opacity:0.4"/>
                            </radialGradient>
                        </defs>
                        <ellipse cx="200" cy="150" rx="80" ry="50" fill="url(#turmericStain)">
                            <animate attributeName="opacity" values="0.6;0.8;0.6" dur="2s" repeatCount="indefinite"/>
                        </ellipse>
                        <ellipse cx="185" cy="145" rx="20" ry="15" fill="#FFC107" opacity="0.4"/>
                        <ellipse cx="215" cy="155" rx="18" ry="12" fill="#FFC107" opacity="0.3"/>
                        <text x="200" y="250" text-anchor="middle" fill="white" font-size="14">
                            ‡§π‡§≤‡•ç‡§¶‡•Ä ‡§ï‡§æ ‡§∞‡§Ç‡§ó - ‡§∏‡§¨‡§∏‡•á ‡§π‡§≤‡•ç‡§ï‡§æ ‡§¶‡§æ‡§ó
                        </text>
                    </svg>`
                ]
            };
            
            return visuals[kashayaId][level];
        }

        function setupSliderInteraction() {
            const slider = document.getElementById('customSlider');
            const thumb = document.getElementById('sliderThumb');
            const track = document.getElementById('sliderTrack');
            let isDragging = false;
            
            const positions = [12.5, 37.5, 62.5, 87.5]; // Percentage positions for 4 levels
            
            function updateSliderPosition(clientX) {
                const rect = slider.getBoundingClientRect();
                const x = clientX - rect.left;
                const percentage = (x / rect.width) * 100;
                
                // Find nearest position
                let nearestIndex = 0;
                let minDistance = Math.abs(percentage - positions[0]);
                
                for (let i = 1; i < positions.length; i++) {
                    const distance = Math.abs(percentage - positions[i]);
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestIndex = i;
                    }
                }
                
                // Update visual position
                thumb.style.left = positions[nearestIndex] + '%';
                track.style.width = (positions[nearestIndex] + 12.5) + '%';
                
                // Update intensity marks
                document.querySelectorAll('.intensity-mark').forEach((mark, i) => {
                    mark.classList.toggle('active', i === nearestIndex);
                });
                
                // Update visual if changed
                if (gameState.currentIntensity !== nearestIndex) {
                    gameState.currentIntensity = nearestIndex;
                    updateIntensityVisual(gameState.currentKashaya, nearestIndex);
                }
            }
            
            thumb.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mousemove', (e) => {
                if (isDragging) updateSliderPosition(e.clientX);
            });
            document.addEventListener('mouseup', () => isDragging = false);
            
            slider.addEventListener('click', (e) => {
                updateSliderPosition(e.clientX);
            });
            
            // Touch support
            thumb.addEventListener('touchstart', () => isDragging = true);
            document.addEventListener('touchmove', (e) => {
                if (isDragging) updateSliderPosition(e.touches[0].clientX);
            });
            document.addEventListener('touchend', () => isDragging = false);
        }

        // Start No-Kashaya Wheel
        function startNoKashaya() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">
                        <span>‚ò∏Ô∏è</span>
                        <span>‡•Ø ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø - ‡§∏‡•Ç‡§ï‡•ç‡§∑‡•ç‡§Æ ‡§ï‡§∑‡§æ‡§Ø</span>
                    </h2>
                    <p style="margin-bottom: 2rem;">
                        ‡§®‡•ã ‡§Ö‡§∞‡•ç‡§•‡§æ‡§§‡•ç ‡§à‡§∑‡§§‡•ç (‡§ï‡§ø‡§Ç‡§ö‡§ø‡§§‡•ç) ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§æ ‡§µ‡•á‡§¶‡§® ‡§ï‡§∞‡§æ‡§µ, ‡§â‡§∏‡•á ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§Ø‡§æ ‡§Ö‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç‡•§
                    </p>
                    
                    <div class="nokashaya-wheel">
                        <div class="wheel-center">‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø</div>
                        ${kashayaData.noKashayas.map((nk, index) => {
                            const angle = (360 / 9) * index;
                            const radius = 150;
                            const x = Math.cos((angle - 90) * Math.PI / 180) * radius + 200;
                            const y = Math.sin((angle - 90) * Math.PI / 180) * radius + 200;
                            return `
                                <div class="petal" style="left: ${x - 60}px; top: ${y - 30}px; transform: rotate(${angle}deg);"
                                     onclick="showNoKashaya('${nk.id}')">
                                    <span style="transform: rotate(-${angle}deg);">
                                        ${nk.icon} ${nk.name}
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div id="noKashayaInfo" style="background: white; padding: 1.5rem; border-radius: 12px; margin-top: 2rem; display: none;">
                        <!-- Info will be displayed here -->
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="testNoKashaya()">‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ</button>
                        <button class="action-btn" onclick="startMinigames()">‡§Æ‡§ø‡§®‡•Ä‡§ó‡•á‡§Æ ‡§ñ‡•á‡§≤‡•á‡§Ç</button>
                    </div>
                </div>
            `;
        }

        function showNoKashaya(id) {
            const nk = kashayaData.noKashayas.find(n => n.id === id);
            const infoDiv = document.getElementById('noKashayaInfo');
            
            infoDiv.style.display = 'block';
            infoDiv.innerHTML = `
                <h3>${nk.icon} ${nk.name} (${nk.english})</h3>
                <p><strong>‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§æ:</strong> ${nk.definition}</p>
            `;
            
            updateScore(20);
            if (!gameState.learnedNoKashayas.includes(id)) {
                gameState.learnedNoKashayas.push(id);
                if (gameState.learnedNoKashayas.length === 9) {
                    showAchievement('‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û', '‡§∏‡§≠‡•Ä ‡•Ø ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Ä‡§ñ‡§æ!');
                }
            }
        }

        // Add this entire helper function to your script
        function showQuiz(questions, title) {
            let currentQuestion = 0;
            let score = 0;
        
            function displayQuestion() {
                if (currentQuestion >= questions.length) {
                    showModal(`${title} ‡§™‡•Ç‡§∞‡•ç‡§£!`, `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${questions.length}`);
                    updateScore(score * 100); // Award points for the quiz
                    // Add a soul cleansing animation here if the score is good
                    return;
                }
        
                const q = questions[currentQuestion];
                const content = document.getElementById('lessonContent');
                content.innerHTML = `
                    <div class="quiz-container">
                        <h2>${title}</h2>
                        <p style="margin-bottom: 1rem;">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}/${questions.length}</p>
                        <div class="question">${q.question}</div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <div class="option" onclick="handleAnswer(${i}, ${q.correct})">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        
            window.handleAnswer = function(selectedIndex, correctIndex) {
                const options = document.querySelectorAll('.option');
                options.forEach(opt => opt.style.pointerEvents = 'none'); // Disable further clicks
        
                if (selectedIndex === correctIndex) {
                    options[selectedIndex].classList.add('correct');
                    score++;
                } else {
                    options[selectedIndex].classList.add('incorrect');
                    options[correctIndex].classList.add('correct');
                }
        
                setTimeout(() => {
                    currentQuestion++;
                    displayQuestion();
                }, 1500); // Wait 1.5 seconds before showing the next question
            };
        
            displayQuestion();
        }
        // Start Minigames
        function startMinigames() {
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('gameContainer').classList.add('active');
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2 style="color: var(--primary);">‡§ï‡§∑‡§æ‡§Ø ‡§Æ‡§ø‡§®‡•Ä‡§ó‡•á‡§Æ‡•ç‡§∏</h2>
                    <p>‡§ñ‡•á‡§≤ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡•á‡§Ç</p>
                    
                    <div class="stage-grid">
                        <div class="stage-card" onclick="startAnalogyMatch()">
                            <div class="stage-icon">üéØ</div>
                            <div class="stage-title">‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§ ‡§Æ‡§ø‡§≤‡§æ‡§®</div>
                        </div>
                        
                        <div class="stage-card" onclick="startEthicalSimulator()">
                            <div class="stage-icon">‚öñÔ∏è</div>
                            <div class="stage-title">‡§®‡•à‡§§‡§ø‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ</div>
                        </div>
                        
                        <div class="stage-card" onclick="startAntidoteGame()">
                            <div class="stage-icon">üíä</div>
                            <div class="stage-title">‡§â‡§™‡§æ‡§Ø ‡§ñ‡•á‡§≤</div>
                        </div>
                        
                        <div class="stage-card" onclick="startKashayaTimer()">
                            <div class="stage-icon">‚è±Ô∏è</div>
                            <div class="stage-title">‡§ï‡§∑‡§æ‡§Ø ‡§∏‡§Æ‡§Ø</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Minigame 1: Analogy Match
        function startAnalogyMatch() {
            const analogies = [
                {kashaya: '‡§ï‡•ç‡§∞‡•ã‡§ß - ‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', analogy: '‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ'},
                {kashaya: '‡§ï‡•ç‡§∞‡•ã‡§ß - ‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', analogy: '‡§ú‡§≤ ‡§ï‡•Ä ‡§∞‡•á‡§ñ‡§æ'},
                {kashaya: '‡§Æ‡§æ‡§® - ‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', analogy: '‡§™‡§§‡•ç‡§•‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠'},
                {kashaya: '‡§Æ‡§æ‡§® - ‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', analogy: '‡§≤‡§§‡§æ ‡§∏‡•ç‡§§‡§Æ‡•ç‡§≠'},
                {kashaya: '‡§Æ‡§æ‡§Ø‡§æ - ‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', analogy: '‡§¨‡§æ‡§Ç‡§∏ ‡§ï‡•Ä ‡§ú‡§°‡§º'},
                {kashaya: '‡§Æ‡§æ‡§Ø‡§æ - ‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', analogy: '‡§ñ‡•Å‡§∞‡§™‡•á ‡§ï‡•á ‡§∏‡§Æ‡§æ‡§®'},
                {kashaya: '‡§≤‡•ã‡§≠ - ‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', analogy: '‡§ï‡•É‡§Æ‡§ø‡§∞‡§æ‡§ó ‡§ï‡•á ‡§∞‡§Ç‡§ó'},
                {kashaya: '‡§≤‡•ã‡§≠ - ‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', analogy: '‡§π‡§≤‡•ç‡§¶‡•Ä ‡§ï‡§æ ‡§∞‡§Ç‡§ó'}
            ];
            
            const shuffled = [...analogies].sort(() => Math.random() - 0.5);
            let matches = 0;
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2>‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§ ‡§Æ‡§ø‡§≤‡§æ‡§®</h2>
                    <p>‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•ã ‡§â‡§∏‡§ï‡•á ‡§∏‡§π‡•Ä ‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡§æ‡§è‡§Ç</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                        <div>
                            <h3>‡§ï‡§∑‡§æ‡§Ø-‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ</h3>
                            ${shuffled.map((item, i) => `
                                <div class="option" id="kashaya-${i}" style="margin: 0.5rem 0;">
                                    ${item.kashaya}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div>
                            <h3>‡§¶‡•É‡§∑‡•ç‡§ü‡§æ‡§®‡•ç‡§§</h3>
                            ${shuffled.map((item, i) => `
                                <div class="option" id="analogy-${i}" style="margin: 0.5rem 0;">
                                    ${analogies[i].analogy}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="checkAnalogyMatches()">‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç</button>
                </div>
            `;
        }

        // Minigame 2: Ethical Response Simulator
        function startEthicalSimulator() {
            const scenarios = [
                {
                    situation: '‡§ï‡•ã‡§à ‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§™‡§Æ‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
                    options: [
                        {text: '‡§ú‡•Ä‡§µ‡§®‡§≠‡§∞ ‡§¶‡•ç‡§µ‡•á‡§∑ ‡§∞‡§ñ‡§®‡§æ', intensity: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', result: '‡§®‡§∞‡§ï‡§ó‡§§‡§ø'},
                        {text: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï ‡§ï‡•ç‡§∞‡•ã‡§ß', intensity: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', result: '‡§§‡§ø‡§∞‡•ç‡§Ø‡§Ç‡§ö‡§ó‡§§‡§ø'},
                        {text: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï ‡§®‡§æ‡§∞‡§æ‡§ú', intensity: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', result: '‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§ó‡§§‡§ø'},
                        {text: '‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Æ‡§æ‡§´ ‡§ï‡§∞‡§®‡§æ', intensity: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', result: '‡§¶‡•á‡§µ‡§ó‡§§‡§ø'}
                    ]
                },
                {
                    situation: '‡§ß‡§® ‡§ï‡§æ ‡§®‡•Å‡§ï‡§∏‡§æ‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à',
                    options: [
                        {text: '‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§≤‡•ã‡§≠ ‡§∏‡•á ‡§î‡§∞ ‡§ß‡§® ‡§ï‡§Æ‡§æ‡§®‡§æ', intensity: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', result: '‡§®‡§∞‡§ï‡§ó‡§§‡§ø'},
                        {text: '‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§∞‡§®‡§æ', intensity: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', result: '‡§§‡§ø‡§∞‡•ç‡§Ø‡§Ç‡§ö‡§ó‡§§‡§ø'},
                        {text: '‡§•‡•ã‡§°‡§º‡§æ ‡§¶‡•Å‡§É‡§ñ', intensity: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', result: '‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§ó‡§§‡§ø'},
                        {text: '‡§∏‡§Ç‡§§‡•ã‡§∑ ‡§∞‡§ñ‡§®‡§æ', intensity: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', result: '‡§¶‡•á‡§µ‡§ó‡§§‡§ø'}
                    ]
                }
            ];
            
            let currentScenario = 0;
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2>‡§®‡•à‡§§‡§ø‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡§ø‡§Æ‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞</h2>
                    
                    <div class="scenario-card">
                        <h3>‡§™‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</h3>
                        <p style="font-size: 1.2rem;">${scenarios[currentScenario].situation}</p>
                    </div>
                    
                    <div class="options" style="margin-top: 2rem;">
                        ${scenarios[currentScenario].options.map((opt, i) => `
                            <div class="option" onclick="showEthicalResult('${opt.result}', '${opt.intensity}')">
                                ${opt.text}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="resultDisplay" style="margin-top: 2rem; display: none;">
                        <!-- Result will be shown here -->
                    </div>
                </div>
            `;
        }

        function showEthicalResult(result, intensity) {
            const display = document.getElementById('resultDisplay');
            display.style.display = 'block';
            display.innerHTML = `
                <div class="scenario-card">
                    <h3>‡§™‡§∞‡§ø‡§£‡§æ‡§Æ:</h3>
                    <p><strong>‡§ï‡§∑‡§æ‡§Ø ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ:</strong> ${intensity}</p>
                    <p><strong>‡§ó‡§§‡§ø:</strong> ${result}</p>
                    <p style="margin-top: 1rem;">
                        ${result === '‡§¶‡•á‡§µ‡§ó‡§§‡§ø' ? '‚ú® ‡§â‡§§‡•ç‡§§‡§Æ! ‡§Ü‡§™‡§®‡•á ‡§∏‡§π‡•Ä ‡§Æ‡§æ‡§∞‡•ç‡§ó ‡§ö‡•Å‡§®‡§æ‡•§' : 
                          result === '‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§ó‡§§‡§ø' ? 'üëç ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏, ‡§î‡§∞ ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§' :
                          '‚ö†Ô∏è ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®! ‡§Ø‡§π ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§Ç‡§ß‡§® ‡§ï‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§π‡•à‡•§'}
                    </p>
                </div>
            `;
            
            updateScore(result === '‡§¶‡•á‡§µ‡§ó‡§§‡§ø' ? 100 : result === '‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø‡§ó‡§§‡§ø' ? 50 : 10);
        }

        // Minigame 3: Antidote Game
        function startAntidoteGame() {
            const problems = [
                {problem: '‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§ï‡•ç‡§∞‡•ã‡§ß', remedy: '‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®', icon: 'üèÉ'},
                {problem: '‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞', remedy: '‡§¨‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡§æ', icon: 'üôè'},
                {problem: '‡§õ‡§≤-‡§ï‡§™‡§ü', remedy: '‡§∏‡§∞‡§≤‡§§‡§æ', icon: 'üíé'},
                {problem: '‡§≤‡•ã‡§≠', remedy: '‡§∏‡§Ç‡§§‡•ã‡§∑', icon: 'üòå'}
            ];
            
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="minigame-container">
                    <h2>‡§â‡§™‡§æ‡§Ø ‡§ñ‡•á‡§≤</h2>
                    <p>‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§â‡§™‡§ö‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin: 2rem 0;">
                        ${problems.map((p, i) => `
                            <div class="scenario-card">
                                <h3>${p.problem}</h3>
                                <div style="margin-top: 1rem;">
                                    <select id="remedy-${i}" style="padding: 0.5rem; width: 100%;">
                                        <option value="">‡§â‡§™‡§æ‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç...</option>
                                        <option value="‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®">‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®</option>
                                        <option value="‡§¨‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡§æ">‡§¨‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡§æ</option>
                                        <option value="‡§∏‡§∞‡§≤‡§§‡§æ">‡§∏‡§∞‡§≤‡§§‡§æ</option>
                                        <option value="‡§∏‡§Ç‡§§‡•ã‡§∑">‡§∏‡§Ç‡§§‡•ã‡§∑</option>
                                    </select>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="action-btn" onclick="checkRemedies()">‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç</button>
                </div>
            `;
        }

        function checkRemedies() {
            const problems = [
                {problem: '‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§ï‡•ç‡§∞‡•ã‡§ß', remedy: '‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§®'},
                {problem: '‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞', remedy: '‡§¨‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§®‡§æ'},
                {problem: '‡§õ‡§≤-‡§ï‡§™‡§ü', remedy: '‡§∏‡§∞‡§≤‡§§‡§æ'},
                {problem: '‡§≤‡•ã‡§≠', remedy: '‡§∏‡§Ç‡§§‡•ã‡§∑'}
            ];
            
            let correct = 0;
            problems.forEach((p, i) => {
                const selected = document.getElementById(`remedy-${i}`).value;
                if (selected === p.remedy) correct++;
            });
            
            showModal('‡§™‡§∞‡§ø‡§£‡§æ‡§Æ', `‡§Ü‡§™‡§®‡•á ${correct}/4 ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡§ø‡§è!`);
            updateScore(correct * 50);
        }

        // Minigame 4: Kashaya Timer
        function startKashayaTimer() {
            const durations = [
                {kashaya: '‡§Ö‡§®‡§®‡•ç‡§§‡§æ‡§®‡•Å‡§¨‡§®‡•ç‡§ß‡•Ä', duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï'},
                {kashaya: '‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', duration: '‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï'},
                {kashaya: '‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§®‡§æ‡§µ‡§∞‡§£', duration: '‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï'},
                {kashaya: '‡§∏‡§Ç‡§ú‡•ç‡§µ‡§≤‡§®', duration: '‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§'}
            ];
            
            let timeLeft = 30;
            let score = 0;
            let currentQuestion = 0;
            
            const content = document.getElementById('lessonContent');
            
            function showNextQuestion() {
                if (currentQuestion >= durations.length || timeLeft <= 0) {
                    showModal('‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!', `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score} ‡§Ö‡§Ç‡§ï`);
                    updateScore(score);
                    return;
                }
                
                const q = durations[currentQuestion];
                content.innerHTML = `
                    <div class="minigame-container">
                        <h2>‡§ï‡§∑‡§æ‡§Ø ‡§∏‡§Æ‡§Ø ‡§ö‡•Å‡§®‡•å‡§§‡•Ä</h2>
                        <div class="timer-display">‚è±Ô∏è ${timeLeft} ‡§∏‡•á‡§ï‡§Ç‡§°</div>
                        
                        <div class="scenario-card">
                            <h3>${q.kashaya} ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•Ä ‡§Ö‡§µ‡§ß‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?</h3>
                            <div class="options" style="margin-top: 1rem;">
                                <div class="option" onclick="checkDuration('‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§')">‡§Ö‡§®‡•ç‡§§‡§∞‡•ç‡§Æ‡•Å‡§π‡•Ç‡§∞‡•ç‡§§</div>
                                <div class="option" onclick="checkDuration('‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï')">‡•ß‡•´ ‡§¶‡§ø‡§® ‡§§‡§ï</div>
                                <div class="option" onclick="checkDuration('‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï')">‡•¨ ‡§Æ‡§æ‡§π ‡§§‡§ï</div>
                                <div class="option" onclick="checkDuration('‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï')">‡•¨ ‡§Æ‡§æ‡§π ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            window.checkDuration = function(answer) {
                if (answer === durations[currentQuestion].duration) {
                    score += 100;
                    showAchievement('‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞!', '+100 ‡§Ö‡§Ç‡§ï');
                }
                currentQuestion++;
                showNextQuestion();
            };
            
            // Start timer
            const timer = setInterval(() => {
                timeLeft--;
                const display = document.querySelector('.timer-display');
                if (display) display.textContent = `‚è±Ô∏è ${timeLeft} ‡§∏‡•á‡§ï‡§Ç‡§°`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showNextQuestion();
                }
            }, 1000);
            
            showNextQuestion();
        }

        // Show Remedies
        function showRemedies() {
            const content = document.getElementById('lessonContent');
            content.innerHTML = `
                <div class="lesson-section">
                    <h2 class="section-title">üíä ‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•á ‡§â‡§™‡§ö‡§æ‡§∞</h2>
                    
                    ${kashayaData.types.map(k => `
                        <div class="scenario-card" style="margin: 1rem 0;">
                            <h3>${k.icon} ${k.name} ‡§ï‡•á ‡§â‡§™‡§æ‡§Ø:</h3>
                            <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                                ${k.remedies.map(r => `<li style="margin: 0.5rem 0;">${r}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="startQuiz()">‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ</button>
                        <button class="action-btn" onclick="backToMenu()">‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•Ç</button>
                    </div>
                </div>
            `;
        }

        // Quiz
        function startQuiz() {
            const questions = [
                {
                    question: '‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§ø‡§∏‡•á ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç?',
                    options: [
                        '‡§ú‡•ã ‡§Ü‡§§‡•ç‡§Æ‡§æ ‡§ï‡•á ‡§ö‡§æ‡§∞‡§ø‡§§‡•ç‡§∞ ‡§ó‡•Å‡§£ ‡§ï‡§æ ‡§ò‡§æ‡§§ ‡§ï‡§∞‡•á',
                        '‡§ú‡•ã ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•ã ‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§¨‡§®‡§æ‡§è',
                        '‡§ú‡•ã ‡§ß‡§® ‡§¶‡•á',
                        '‡§ú‡•ã ‡§∏‡•Å‡§ñ ‡§¶‡•á'
                    ],
                    correct: 0
                },
                {
                    question: '‡§ï‡§ø‡§§‡§®‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§∑‡§æ‡§Ø ‡§π‡•à‡§Ç?',
                    options: ['‡•®', '‡•©', '‡•™', '‡•´'],
                    correct: 2
                },
                {
                    question: '‡§®‡§∞‡§ï‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§ï‡§∑‡§æ‡§Ø ‡§™‡•ç‡§∞‡§ß‡§æ‡§® ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?',
                    options: ['‡§Æ‡§æ‡§®', '‡§Æ‡§æ‡§Ø‡§æ', '‡§≤‡•ã‡§≠', '‡§ï‡•ç‡§∞‡•ã‡§ß'],
                    correct: 3
                },
                {
                    question: '‡§™‡§æ‡§Ç‡§ö‡•ã‡§Ç ‡§™‡§æ‡§™‡•ã‡§Ç ‡§ï‡§æ ‡§¨‡§æ‡§™ ‡§ï‡§ø‡§∏‡•á ‡§ï‡§π‡§æ ‡§π‡•à?',
                    options: ['‡§ï‡•ç‡§∞‡•ã‡§ß', '‡§Æ‡§æ‡§®', '‡§Æ‡§æ‡§Ø‡§æ', '‡§≤‡•ã‡§≠'],
                    correct: 3
                },
                {
                    question: '‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§ø‡§§‡§®‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç?',
                    options: ['‡•≠', '‡•Æ', '‡•Ø', '‡•ß‡•¶'],
                    correct: 2
                }
            ];
            
            let currentQuestion = 0;
            let score = 0;
            
            function showQuestion() {
                if (currentQuestion >= questions.length) {
                    showModal('‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§§‡•ç‡§§‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£!', `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${questions.length}`);
                    updateScore(score * 100);
                    return;
                }
                
                const q = questions[currentQuestion];
                const content = document.getElementById('lessonContent');
                content.innerHTML = `
                    <div class="quiz-container">
                        <h2>‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}/${questions.length}</h2>
                        <div class="question">${q.question}</div>
                        <div class="options">
                            ${q.options.map((opt, i) => `
                                <div class="option" onclick="checkAnswer(${i}, ${q.correct})">
                                    ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            window.checkAnswer = function(selected, correct) {
                const options = document.querySelectorAll('.option');
                if (selected === correct) {
                    options[selected].classList.add('correct');
                    score++;
                } else {
                    options[selected].classList.add('incorrect');
                    options[correct].classList.add('correct');
                }
                
                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 1500);
            };
            
            showQuestion();
        }

        // Test functions
        function testIntensityKnowledge() {
            showModal('‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ', '‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§Ü ‡§∞‡§π‡•Ä ‡§π‡•à...');
            updateScore(100);
        }
        function testNoKashaya() {
            const questions = [
                {
                    question: '‡§ï‡•Å‡§≤ ‡§ï‡§ø‡§§‡§®‡•Ä ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç? (How many No-kashayas are there in total?)',
                    options: ['‡•≠', '‡•Æ', '‡•Ø', '‡•ß‡•¶'],
                    correct: 2
                },
                {
                    question: '‡§á‡§∑‡•ç‡§ü ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•á ‡§µ‡§ø‡§Ø‡•ã‡§ó ‡§∏‡•á ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ï‡•ç‡§≤‡•á‡§∂ ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç? (The suffering that arises from separation from a desired object is called?)',
                    options: ['‡§∞‡§§‡§ø (Attachment)', '‡§∂‡•ã‡§ï (Sorrow)', '‡§≠‡§Ø (Fear)', '‡§π‡§æ‡§∏‡•ç‡§Ø (Laughter)'],
                    correct: 1
                },
                {
                    question: '‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§∏‡•ç‡§•‡§æ‡§® ‡§Ø‡§æ ‡§µ‡§∏‡•ç‡§§‡•Å ‡§∏‡•á ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§≤‡§ó‡§æ‡§µ (‡§™‡•ç‡§∞‡•Ä‡§§‡§ø) ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ï‡§ø‡§∏ ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§ï‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§π‡•à? (A person has a strong attachment (preeti) to a place or thing. This is the effect of which No-kashaya?)',
                    options: ['‡§Ö‡§∞‡§§‡§ø (Aversion)', '‡§ú‡•Å‡§ó‡•Å‡§™‡•ç‡§∏‡§æ (Disgust)', '‡§∞‡§§‡§ø (Attachment)', '‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§µ‡•á‡§¶ (Feminine Inclination)'],
                    correct: 2
                },
                {
                    question: '‡§ï‡§ø‡§∏‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•ã ‡§¶‡•á‡§ñ‡§ï‡§∞ ‡§ó‡•ç‡§≤‡§æ‡§®‡§ø (disgust) ‡§ï‡§æ ‡§≠‡§æ‡§µ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡§®‡§æ, ‡§Ø‡§π ‡§ï‡§ø‡§∏ ‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§ï‡•á ‡§â‡§¶‡§Ø ‡§∏‡•á ‡§π‡•ã‡§§‡§æ ‡§π‡•à? (Feeling a sense of disgust upon seeing something is caused by the rise of which No-kashaya?)',
                    options: ['‡§≠‡§Ø (Fear)', '‡§∂‡•ã‡§ï (Sorrow)', '‡§π‡§æ‡§∏‡•ç‡§Ø (Laughter)', '‡§ú‡•Å‡§ó‡•Å‡§™‡•ç‡§∏‡§æ (Disgust)'],
                    correct: 3
                },
                {
                    question: '"‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø" ‡§Æ‡•á‡§Ç "‡§®‡•ã" ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§π‡•à? (What does the word "No" in "No-kashaya" signify?)',
                    options: ['‡§™‡•Ç‡§∞‡•ç‡§£ (Complete)', '‡§®‡§π‡•Ä‡§Ç (Not)', '‡§à‡§∑‡§§‡•ç / ‡§ï‡§ø‡§Ç‡§ö‡§ø‡§§‡•ç (Slight / Minor)', '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ (Unknown)'],
                    correct: 2
                }
            ];
            
            showQuiz(questions, '‡§®‡•ã‡§ï‡§∑‡§æ‡§Ø ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ');
        }

        function checkAnalogyMatches() {
            showModal('‡§ú‡§æ‡§Ç‡§ö ‡§™‡•Ç‡§∞‡•ç‡§£', '‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§∏‡§π‡•Ä ‡§ï‡§ø‡§è!');
            updateScore(200);
        }

        // Utility Functions
        function backToMenu() {
            document.getElementById('gameContainer').classList.remove('active');
            document.getElementById('mainMenu').classList.add('active');
        }

        function updateScore(points) {
            gameState.score += points;
            document.getElementById('scoreValue').textContent = gameState.score;
            
            const newLevel = Math.floor(gameState.score / 500) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                document.getElementById('levelValue').textContent = gameState.level;
                showAchievement('‡§∏‡•ç‡§§‡§∞ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø!', `‡§∏‡•ç‡§§‡§∞ ${gameState.level} ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§!`);
            }
        }

        function showAchievement(title, desc) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = desc;
            
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
    </script>
</body>
</html>
